import{c as qe,j as e,m as _e,D as jr,r as st,W as kr,Y as Nr,C as wr,R as _r,T as Sr,p as Tt,n as Vt,A as Cr,ap as Pr,z as he,aq as Tr,a1 as He,ai as Er,a7 as Et,Q as Ve,aa as nt,G as Mt,Z as Rr,s as Lr,B as Ar}from"./ui-DzcvAssw.js";import{a as n,f as ut,u as Ir}from"./vendor-CfX-nNg5.js";import{a as ee,K as Bt,A as Wt,L as de,M as Or,x as $r,C as Dr,s as Fr,N as zr,G as Vr,E as Mr,O as Br,B as Wr,Q as je,S as Hr}from"./index-BjfinGfq.js";import{R as Kr,A as Ur,F as Gr}from"./WindowScroller-D1vhakJR.js";import{M as qr,T as Jr}from"./TrainingReminderBanner-BvYnbVKY.js";import{r as Je,A as Zr,ad as Yr,ae as Xr,o as mt,af as Qr,ag as ea,ah as ta,ai as ra,aj as aa,ak as sa,i as We,u as Ht,al as na,am as Rt,an as la,ao as Kt,H as Ut,D as pt,ap as Gt,aq as ia,Z as xt,L as gt,y as oa,ar as ca,b as lt,z as qt,N as ht,U as Jt,Q as Zt,T as Yt,V as da,X as ua,as as ma,W as Lt,d as Xt,R as pa,e as xa,f as ga,g as ha,G as ya,j as Qt,k as fa,at as ba,l as va,t as ja,p as ka,q as er,au as At,B as Na,J as wa,C as ze,E as _a,F as Sa,av as Ca,S as Pa,a6 as Ta,a7 as Ea,a8 as Ra,a9 as La,aa as Aa,ab as Ia,ac as Oa}from"./CartesianChart-CIQiFx3T.js";import"./defineProperty-CzrzvwXk.js";import"./slicedToArray-w3y9pYby.js";function Ke(){return Ke=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var s in a)({}).hasOwnProperty.call(a,s)&&(t[s]=a[s])}return t},Ke.apply(null,arguments)}function It(t,r){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable})),a.push.apply(a,s)}return a}function $a(t){for(var r=1;r<arguments.length;r++){var a=arguments[r]!=null?arguments[r]:{};r%2?It(Object(a),!0).forEach(function(s){Da(t,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):It(Object(a)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(a,s))})}return t}function Da(t,r,a){return(r=Fa(r))in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}function Fa(t){var r=za(t,"string");return typeof r=="symbol"?r:r+""}function za(t,r){if(typeof t!="object"||!t)return t;var a=t[Symbol.toPrimitive];if(a!==void 0){var s=a.call(t,r);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}var ue=32,Va={align:"center",iconSize:14,inactiveColor:"#ccc",layout:"horizontal",verticalAlign:"middle"};function Ma(t){var{data:r,iconType:a,inactiveColor:s}=t,l=ue/2,c=ue/6,u=ue/3,d=r.inactive?s:r.color,m=a??r.type;if(m==="none")return null;if(m==="plainline"){var p;return n.createElement("line",{strokeWidth:4,fill:"none",stroke:d,strokeDasharray:(p=r.payload)===null||p===void 0?void 0:p.strokeDasharray,x1:0,y1:l,x2:ue,y2:l,className:"recharts-legend-icon"})}if(m==="line")return n.createElement("path",{strokeWidth:4,fill:"none",stroke:d,d:"M0,".concat(l,"h").concat(u,`
            A`).concat(c,",").concat(c,",0,1,1,").concat(2*u,",").concat(l,`
            H`).concat(ue,"M").concat(2*u,",").concat(l,`
            A`).concat(c,",").concat(c,",0,1,1,").concat(u,",").concat(l),className:"recharts-legend-icon"});if(m==="rect")return n.createElement("path",{stroke:"none",fill:d,d:"M0,".concat(ue/8,"h").concat(ue,"v").concat(ue*3/4,"h").concat(-ue,"z"),className:"recharts-legend-icon"});if(n.isValidElement(r.legendIcon)){var g=$a({},r);return delete g.legendIcon,n.cloneElement(r.legendIcon,g)}return n.createElement(Xr,{fill:d,cx:l,cy:l,size:ue,sizeType:"diameter",type:m})}function Ba(t){var{payload:r,iconSize:a,layout:s,formatter:l,inactiveColor:c,iconType:u}=t,d={x:0,y:0,width:ue,height:ue},m={display:s==="horizontal"?"inline-block":"block",marginRight:10},p={display:"inline-block",verticalAlign:"middle",marginRight:4};return r.map((g,k)=>{var w=g.formatter||l,N=qe({"recharts-legend-item":!0,["legend-item-".concat(k)]:!0,inactive:g.inactive});if(g.type==="none")return null;var f=g.inactive?c:g.color,j=w?w(g.value,g,k):g.value;return n.createElement("li",Ke({className:N,style:m,key:"legend-item-".concat(k)},Zr(t,g,k)),n.createElement(Yr,{width:a,height:a,viewBox:d,style:p,"aria-label":"".concat(j," legend icon")},n.createElement(Ma,{data:g,iconType:u,inactiveColor:c})),n.createElement("span",{className:"recharts-legend-item-text",style:{color:f}},j))})}var Wa=t=>{var r=Je(t,Va),{payload:a,layout:s,align:l}=r;if(!a||!a.length)return null;var c={padding:0,margin:0,textAlign:s==="horizontal"?l:"left"};return n.createElement("ul",{className:"recharts-default-legend",style:c},n.createElement(Ba,Ke({},r,{payload:a})))};function Ha(){return mt(Qr)}var Ka=["contextPayload"];function it(){return it=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var s in a)({}).hasOwnProperty.call(a,s)&&(t[s]=a[s])}return t},it.apply(null,arguments)}function Ot(t,r){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable})),a.push.apply(a,s)}return a}function Ie(t){for(var r=1;r<arguments.length;r++){var a=arguments[r]!=null?arguments[r]:{};r%2?Ot(Object(a),!0).forEach(function(s){Ua(t,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):Ot(Object(a)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(a,s))})}return t}function Ua(t,r,a){return(r=Ga(r))in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}function Ga(t){var r=qa(t,"string");return typeof r=="symbol"?r:r+""}function qa(t,r){if(typeof t!="object"||!t)return t;var a=t[Symbol.toPrimitive];if(a!==void 0){var s=a.call(t,r);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}function Ja(t,r){if(t==null)return{};var a,s,l=Za(t,r);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);for(s=0;s<c.length;s++)a=c[s],r.indexOf(a)===-1&&{}.propertyIsEnumerable.call(t,a)&&(l[a]=t[a])}return l}function Za(t,r){if(t==null)return{};var a={};for(var s in t)if({}.hasOwnProperty.call(t,s)){if(r.indexOf(s)!==-1)continue;a[s]=t[s]}return a}function Ya(t){return t.value}function Xa(t){var{contextPayload:r}=t,a=Ja(t,Ka),s=la(r,t.payloadUniqBy,Ya),l=Ie(Ie({},a),{},{payload:s});return n.isValidElement(t.content)?n.cloneElement(t.content,l):typeof t.content=="function"?n.createElement(t.content,l):n.createElement(Wa,l)}function Qa(t,r,a,s,l,c){var{layout:u,align:d,verticalAlign:m}=r,p,g;return(!t||(t.left===void 0||t.left===null)&&(t.right===void 0||t.right===null))&&(d==="center"&&u==="vertical"?p={left:((s||0)-c.width)/2}:p=d==="right"?{right:a&&a.right||0}:{left:a&&a.left||0}),(!t||(t.top===void 0||t.top===null)&&(t.bottom===void 0||t.bottom===null))&&(m==="middle"?g={top:((l||0)-c.height)/2}:g=m==="bottom"?{bottom:a&&a.bottom||0}:{top:a&&a.top||0}),Ie(Ie({},p),g)}function es(t){var r=Ht();return n.useEffect(()=>{r(na(t))},[r,t]),null}function ts(t){var r=Ht();return n.useEffect(()=>(r(Rt(t)),()=>{r(Rt({width:0,height:0}))}),[r,t]),null}function rs(t,r,a,s){return t==="vertical"&&We(r)?{height:r}:t==="horizontal"?{width:a||s}:null}var as={align:"center",iconSize:14,itemSorter:"value",layout:"horizontal",verticalAlign:"bottom"};function tr(t){var r=Je(t,as),a=Ha(),s=ea(),l=ta(),{width:c,height:u,wrapperStyle:d,portal:m}=r,[p,g]=ra([a]),k=aa(),w=sa();if(k==null||w==null)return null;var N=k-(l?.left||0)-(l?.right||0),f=rs(r.layout,u,c,N),j=m?d:Ie(Ie({position:"absolute",width:f?.width||c||"auto",height:f?.height||u||"auto"},Qa(d,r,l,k,w,p)),d),I=m??s;if(I==null||a==null)return null;var v=n.createElement("div",{className:"recharts-legend-wrapper",style:j,ref:g},n.createElement(es,{layout:r.layout,align:r.align,verticalAlign:r.verticalAlign,itemSorter:r.itemSorter}),n.createElement(ts,{width:p.width,height:p.height}),n.createElement(Xa,it({},r,f,{margin:l,chartWidth:k,chartHeight:w,contextPayload:a})));return ut.createPortal(v,I)}tr.displayName="Legend";function ot(){return ot=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var s in a)({}).hasOwnProperty.call(a,s)&&(t[s]=a[s])}return t},ot.apply(null,arguments)}var rr=t=>{var{cx:r,cy:a,r:s,className:l}=t,c=qe("recharts-dot",l);return We(r)&&We(a)&&We(s)?n.createElement("circle",ot({},Ut(t),Kt(t),{className:c,cx:r,cy:a,r:s})):null},ss=["points"];function $t(t,r){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable})),a.push.apply(a,s)}return a}function rt(t){for(var r=1;r<arguments.length;r++){var a=arguments[r]!=null?arguments[r]:{};r%2?$t(Object(a),!0).forEach(function(s){ns(t,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):$t(Object(a)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(a,s))})}return t}function ns(t,r,a){return(r=ls(r))in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}function ls(t){var r=is(t,"string");return typeof r=="symbol"?r:r+""}function is(t,r){if(typeof t!="object"||!t)return t;var a=t[Symbol.toPrimitive];if(a!==void 0){var s=a.call(t,r);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}function Ue(){return Ue=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var s in a)({}).hasOwnProperty.call(a,s)&&(t[s]=a[s])}return t},Ue.apply(null,arguments)}function os(t,r){if(t==null)return{};var a,s,l=cs(t,r);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);for(s=0;s<c.length;s++)a=c[s],r.indexOf(a)===-1&&{}.propertyIsEnumerable.call(t,a)&&(l[a]=t[a])}return l}function cs(t,r){if(t==null)return{};var a={};for(var s in t)if({}.hasOwnProperty.call(t,s)){if(r.indexOf(s)!==-1)continue;a[s]=t[s]}return a}function ds(t){var{option:r,dotProps:a,className:s}=t;if(n.isValidElement(r))return n.cloneElement(r,a);if(typeof r=="function")return r(a);var l=qe(s,typeof r!="boolean"?r.className:""),c=a??{},{points:u}=c,d=os(c,ss);return n.createElement(rr,Ue({},d,{className:l}))}function us(t,r){return t==null?!1:r?!0:t.length===1}function ms(t){var{points:r,dot:a,className:s,dotClassName:l,dataKey:c,baseProps:u,needClip:d,clipPathId:m,zIndex:p=pt.scatter}=t;if(!us(r,a))return null;var g=Gt(a),k=ia(a),w=r.map((f,j)=>{var I,v,_=rt(rt(rt({r:3},u),k),{},{index:j,cx:(I=f.x)!==null&&I!==void 0?I:void 0,cy:(v=f.y)!==null&&v!==void 0?v:void 0,dataKey:c,value:f.value,payload:f.payload,points:r});return n.createElement(ds,{key:"dot-".concat(j),option:a,dotProps:_,className:l})}),N={};return d&&m!=null&&(N.clipPath="url(#clipPath-".concat(g?"":"dots-").concat(m,")")),n.createElement(xt,{zIndex:p},n.createElement(gt,Ue({className:s},N),w))}function Dt(t,r){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable})),a.push.apply(a,s)}return a}function at(t){for(var r=1;r<arguments.length;r++){var a=arguments[r]!=null?arguments[r]:{};r%2?Dt(Object(a),!0).forEach(function(s){ps(t,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):Dt(Object(a)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(a,s))})}return t}function ps(t,r,a){return(r=xs(r))in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}function xs(t){var r=gs(t,"string");return typeof r=="symbol"?r:r+""}function gs(t,r){if(typeof t!="object"||!t)return t;var a=t[Symbol.toPrimitive];if(a!==void 0){var s=a.call(t,r);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}var hs=t=>{var{point:r,childIndex:a,mainColor:s,activeDot:l,dataKey:c}=t;if(l===!1||r.x==null||r.y==null)return null;var u={index:a,dataKey:c,cx:r.x,cy:r.y,r:4,fill:s??"none",strokeWidth:2,stroke:"#fff",payload:r.payload,value:r.value},d=at(at(at({},u),qt(l)),Kt(l)),m;return n.isValidElement(l)?m=n.cloneElement(l,d):typeof l=="function"?m=l(d):m=n.createElement(rr,d),n.createElement(gt,{className:"recharts-active-dot"},m)};function ys(t){var{points:r,mainColor:a,activeDot:s,itemDataKey:l,zIndex:c=pt.activeDot}=t,u=mt(oa),d=ca();if(r==null||d==null)return null;var m=r.find(p=>d.includes(p.payload));return lt(m)?null:n.createElement(xt,{zIndex:c},n.createElement(hs,{point:m,childIndex:Number(u),mainColor:a,dataKey:l,activeDot:s}))}var ar=(t,r,a,s)=>Zt(t,"xAxis",r,s),sr=(t,r,a,s)=>Yt(t,"xAxis",r,s),nr=(t,r,a,s)=>Zt(t,"yAxis",a,s),lr=(t,r,a,s)=>Yt(t,"yAxis",a,s),fs=ht([Jt,ar,nr,sr,lr],(t,r,a,s,l)=>ma(t,"xAxis")?Lt(r,s,!1):Lt(a,l,!1)),bs=(t,r,a,s,l)=>l;function vs(t){return t.type==="line"}var js=ht([ua,bs],(t,r)=>t.filter(vs).find(a=>a.id===r)),ks=ht([Jt,ar,nr,sr,lr,js,fs,da],(t,r,a,s,l,c,u,d)=>{var{chartData:m,dataStartIndex:p,dataEndIndex:g}=d;if(!(c==null||r==null||a==null||s==null||l==null||s.length===0||l.length===0||u==null)){var{dataKey:k,data:w}=c,N;if(w!=null&&w.length>0?N=w:N=m?.slice(p,g+1),N!=null)return Ws({layout:t,xAxis:r,yAxis:a,xAxisTicks:s,yAxisTicks:l,dataKey:k,bandSize:u,displayedData:N})}});function Ns(t){var r=qt(t),a=3,s=2;if(r!=null){var{r:l,strokeWidth:c}=r,u=Number(l),d=Number(c);return(Number.isNaN(u)||u<0)&&(u=a),(Number.isNaN(d)||d<0)&&(d=s),{r:u,strokeWidth:d}}return{r:a,strokeWidth:s}}var ws=["id"],_s=["type","layout","connectNulls","needClip","shape"],Ss=["activeDot","animateNewValues","animationBegin","animationDuration","animationEasing","connectNulls","dot","hide","isAnimationActive","label","legendType","xAxisId","yAxisId","id"];function Me(){return Me=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var s in a)({}).hasOwnProperty.call(a,s)&&(t[s]=a[s])}return t},Me.apply(null,arguments)}function Ft(t,r){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable})),a.push.apply(a,s)}return a}function ye(t){for(var r=1;r<arguments.length;r++){var a=arguments[r]!=null?arguments[r]:{};r%2?Ft(Object(a),!0).forEach(function(s){Cs(t,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):Ft(Object(a)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(a,s))})}return t}function Cs(t,r,a){return(r=Ps(r))in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}function Ps(t){var r=Ts(t,"string");return typeof r=="symbol"?r:r+""}function Ts(t,r){if(typeof t!="object"||!t)return t;var a=t[Symbol.toPrimitive];if(a!==void 0){var s=a.call(t,r);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}function yt(t,r){if(t==null)return{};var a,s,l=Es(t,r);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);for(s=0;s<c.length;s++)a=c[s],r.indexOf(a)===-1&&{}.propertyIsEnumerable.call(t,a)&&(l[a]=t[a])}return l}function Es(t,r){if(t==null)return{};var a={};for(var s in t)if({}.hasOwnProperty.call(t,s)){if(r.indexOf(s)!==-1)continue;a[s]=t[s]}return a}var Rs=t=>{var{dataKey:r,name:a,stroke:s,legendType:l,hide:c}=t;return[{inactive:c,dataKey:r,type:l,color:s,value:Qt(a,r),payload:t}]};function Ls(t){var{dataKey:r,data:a,stroke:s,strokeWidth:l,fill:c,name:u,hide:d,unit:m}=t;return{dataDefinedOnItem:a,positions:void 0,settings:{stroke:s,strokeWidth:l,fill:c,dataKey:r,nameKey:void 0,name:Qt(u,r),hide:d,type:t.tooltipType,color:t.stroke,unit:m}}}var ir=(t,r)=>"".concat(r,"px ").concat(t-r,"px");function As(t,r){for(var a=t.length%2!==0?[...t,0]:t,s=[],l=0;l<r;++l)s=[...s,...a];return s}var Is=(t,r,a)=>{var s=a.reduce((k,w)=>k+w);if(!s)return ir(r,t);for(var l=Math.floor(t/s),c=t%s,u=r-t,d=[],m=0,p=0;m<a.length;p+=a[m],++m)if(p+a[m]>c){d=[...a.slice(0,m),c-p];break}var g=d.length%2===0?[0,u]:[u];return[...As(a,l),...d,...g].map(k=>"".concat(k,"px")).join(", ")};function Os(t){var{clipPathId:r,points:a,props:s}=t,{dot:l,dataKey:c,needClip:u}=s,{id:d}=s,m=yt(s,ws),p=Ut(m);return n.createElement(ms,{points:a,dot:l,className:"recharts-line-dots",dotClassName:"recharts-line-dot",dataKey:c,baseProps:p,needClip:u,clipPathId:r})}function $s(t){var{showLabels:r,children:a,points:s}=t,l=n.useMemo(()=>s?.map(c=>{var u,d,m={x:(u=c.x)!==null&&u!==void 0?u:0,y:(d=c.y)!==null&&d!==void 0?d:0,width:0,lowerWidth:0,upperWidth:0,height:0};return ye(ye({},m),{},{value:c.value,payload:c.payload,viewBox:m,parentViewBox:void 0,fill:void 0})}),[s]);return n.createElement(Sa,{value:r?l:void 0},a)}function zt(t){var{clipPathId:r,pathRef:a,points:s,strokeDasharray:l,props:c}=t,{type:u,layout:d,connectNulls:m,needClip:p,shape:g}=c,k=yt(c,_s),w=ye(ye({},Ca(k)),{},{fill:"none",className:"recharts-line-curve",clipPath:p?"url(#clipPath-".concat(r,")"):void 0,points:s,type:u,layout:d,connectNulls:m,strokeDasharray:l??c.strokeDasharray});return n.createElement(n.Fragment,null,s?.length>1&&n.createElement(Pa,Me({shapeType:"curve",option:g},w,{pathRef:a})),n.createElement(Os,{points:s,clipPathId:r,props:c}))}function Ds(t){try{return t&&t.getTotalLength&&t.getTotalLength()||0}catch{return 0}}function Fs(t){var{clipPathId:r,props:a,pathRef:s,previousPointsRef:l,longestAnimatedLengthRef:c}=t,{points:u,strokeDasharray:d,isAnimationActive:m,animationBegin:p,animationDuration:g,animationEasing:k,animateNewValues:w,width:N,height:f,onAnimationEnd:j,onAnimationStart:I}=a,v=l.current,_=Na(a,"recharts-line-"),[T,W]=n.useState(!1),V=!T,Q=n.useCallback(()=>{typeof j=="function"&&j(),W(!1)},[j]),L=n.useCallback(()=>{typeof I=="function"&&I(),W(!0)},[I]),O=Ds(s.current),Y=c.current;return n.createElement($s,{points:u,showLabels:V},a.children,n.createElement(wa,{animationId:_,begin:p,duration:g,isActive:m,easing:k,onAnimationEnd:Q,onAnimationStart:L,key:_},U=>{var x=ze(Y,O+Y,U),$=Math.min(x,O),M;if(m)if(d){var se="".concat(d).split(/[,\s]+/gim).map(A=>parseFloat(A));M=Is($,O,se)}else M=ir(O,$);else M=d==null?void 0:String(d);if(v){var J=v.length/u.length,pe=U===1?u:u.map((A,Se)=>{var me=Math.floor(Se*J);if(v[me]){var ce=v[me];return ye(ye({},A),{},{x:ze(ce.x,A.x,U),y:ze(ce.y,A.y,U)})}return w?ye(ye({},A),{},{x:ze(N*2,A.x,U),y:ze(f/2,A.y,U)}):ye(ye({},A),{},{x:A.x,y:A.y})});return l.current=pe,n.createElement(zt,{props:a,points:pe,clipPathId:r,pathRef:s,strokeDasharray:M})}return U>0&&O>0&&(l.current=u,c.current=$),n.createElement(zt,{props:a,points:u,clipPathId:r,pathRef:s,strokeDasharray:M})}),n.createElement(_a,{label:a.label}))}function zs(t){var{clipPathId:r,props:a}=t,s=n.useRef(null),l=n.useRef(0),c=n.useRef(null);return n.createElement(Fs,{props:a,clipPathId:r,previousPointsRef:s,longestAnimatedLengthRef:l,pathRef:c})}var Vs=(t,r)=>{var a,s;return{x:(a=t.x)!==null&&a!==void 0?a:void 0,y:(s=t.y)!==null&&s!==void 0?s:void 0,value:t.value,errorVal:er(t.payload,r)}};class Ms extends n.Component{render(){var{hide:r,dot:a,points:s,className:l,xAxisId:c,yAxisId:u,top:d,left:m,width:p,height:g,id:k,needClip:w,zIndex:N}=this.props;if(r)return null;var f=qe("recharts-line",l),j=k,{r:I,strokeWidth:v}=Ns(a),_=Gt(a),T=I*2+v;return n.createElement(xt,{zIndex:N},n.createElement(gt,{className:f},w&&n.createElement("defs",null,n.createElement(ja,{clipPathId:j,xAxisId:c,yAxisId:u}),!_&&n.createElement("clipPath",{id:"clipPath-dots-".concat(j)},n.createElement("rect",{x:m-T/2,y:d-T/2,width:p+T,height:g+T}))),n.createElement(ka,{xAxisId:c,yAxisId:u,data:s,dataPointFormatter:Vs,errorBarOffset:0},n.createElement(zs,{props:this.props,clipPathId:j}))),n.createElement(ys,{activeDot:this.props.activeDot,points:s,mainColor:this.props.stroke,itemDataKey:this.props.dataKey}))}}var or={activeDot:!0,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",connectNulls:!1,dot:!0,fill:"#fff",hide:!1,isAnimationActive:!ya.isSsr,label:!1,legendType:"line",stroke:"#3182bd",strokeWidth:1,xAxisId:0,yAxisId:0,zIndex:pt.line};function Bs(t){var r=Je(t,or),{activeDot:a,animateNewValues:s,animationBegin:l,animationDuration:c,animationEasing:u,connectNulls:d,dot:m,hide:p,isAnimationActive:g,label:k,legendType:w,xAxisId:N,yAxisId:f,id:j}=r,I=yt(r,Ss),{needClip:v}=fa(N,f),_=ba(),T=va(),W=Xt(),V=mt(U=>ks(U,N,f,W,j));if(T!=="horizontal"&&T!=="vertical"||V==null||_==null)return null;var{height:Q,width:L,x:O,y:Y}=_;return n.createElement(Ms,Me({},I,{id:j,connectNulls:d,dot:m,activeDot:a,animateNewValues:s,animationBegin:l,animationDuration:c,animationEasing:u,isAnimationActive:g,hide:p,label:k,legendType:w,xAxisId:N,yAxisId:f,points:V,layout:T,height:Q,width:L,left:O,top:Y,needClip:v}))}function Ws(t){var{layout:r,xAxis:a,yAxis:s,xAxisTicks:l,yAxisTicks:c,dataKey:u,bandSize:d,displayedData:m}=t;return m.map((p,g)=>{var k=er(p,u);if(r==="horizontal"){var w=At({axis:a,ticks:l,bandSize:d,entry:p,index:g}),N=lt(k)?null:s.scale(k);return{x:w,y:N,value:k,payload:p}}var f=lt(k)?null:a.scale(k),j=At({axis:s,ticks:c,bandSize:d,entry:p,index:g});return f==null||j==null?null:{x:f,y:j,value:k,payload:p}}).filter(Boolean)}function Hs(t){var r=Je(t,or),a=Xt();return n.createElement(pa,{id:r.id,type:"line"},s=>n.createElement(n.Fragment,null,n.createElement(xa,{legendPayload:Rs(r)}),n.createElement(ga,{fn:Ls,args:r}),n.createElement(ha,{type:"line",id:s,data:r.data,xAxisId:r.xAxisId,yAxisId:r.yAxisId,zAxisId:0,dataKey:r.dataKey,hide:r.hide,isPanorama:a}),n.createElement(Bs,Me({},r,{id:s}))))}var cr=n.memo(Hs);cr.displayName="Line";var Ks=["axis"],Us=n.forwardRef((t,r)=>n.createElement(Ta,{chartName:"LineChart",defaultTooltipEventType:"axis",validateTooltipEventTypes:Ks,tooltipPayloadSearcher:Ea,categoricalChartProps:t,ref:r}));const Re={async getEmployeeApplications(t,r){return(await ee.get(`/api/eltv/tracking/applications/${encodeURIComponent(r)}`,{params:{projectId:t}})).data?.data||[]},async getEffectiveness(t){return(await ee.get("/api/eltv/tracking/effectiveness",{params:{projectId:t}})).data?.data||[]},async getABTests(t,r){return(await ee.get("/api/eltv/tracking/ab-tests",{params:{projectId:t,testName:r}})).data?.data||[]},async createABTest(t,r){return(await ee.post("/api/eltv/tracking/ab-tests",{projectId:t,...r||{}})).data?.data},async syncHR(t,r){return(await ee.post("/api/eltv/tracking/hr-sync",{projectId:t,connectionDetails:r})).data?.data},async getLastSync(t){return(await ee.get("/api/eltv/tracking/last-sync",{params:{projectId:t}})).data?.data??null}},Gs=({selectedEmployee:t,isVisible:r,hasDBConnection:a,isPerformanceMode:s=!1})=>{const{toast:l}=Bt(),[c,u]=n.useState(!1),[d,m]=n.useState("tracking"),[p,g]=n.useState([]),[k,w]=n.useState([]),[N,f]=n.useState([]),[j,I]=n.useState(null),[v,_]=n.useState(a),[T,W]=n.useState([]),[V,Q]=n.useState([]),{activeProject:L}=Wt();n.useEffect(()=>{r&&a&&O()},[r,a,t]);const O=async()=>{if(!(!a||!L?.id)){u(!0);try{if(t){const se=await Re.getEmployeeApplications(L.id,t.hr_code);g(se)}const x=await Re.getEffectiveness(L.id);w(x);const $=await Re.getABTests(L.id);f($);const M=await Re.getLastSync(L.id);I(M);try{const se=await ee.get("/api/eltv/uplift/basic",{params:{projectId:L.id}});W(se.data?.data||[]);const J=await ee.get("/api/eltv/uplift/tr",{params:{projectId:L.id}});Q(J.data?.data||[])}catch(se){console.warn("Failed to load uplift summary",se)}_(!0)}catch(x){console.error("Failed to load treatment data:",x),_(!1),l({title:"Error",description:"Failed to load treatment tracking data",variant:"destructive"})}finally{u(!1)}}},Y=async()=>{if(!(!a||!L?.id)){u(!0);try{const x={},$=await Re.syncHR(L.id,x);if($?.records_updated!==void 0)l({title:"Sync Completed",description:`Updated ${$.records_updated} employee records`}),await O();else throw new Error("Sync failed")}catch(x){l({title:"Sync Failed",description:x?.message||"Failed to sync with HR system",variant:"destructive"})}finally{u(!1)}}},U=async()=>{if(!(!a||!L?.id))try{const x=await Re.createABTest(L.id);x?.testName&&(l({title:"A/B Test Created",description:`Created test "${x.testName}" with ${x.control?.length||0} control and ${x.treatment?.length||0} treatment employees`}),await O())}catch(x){l({title:"Failed to Create A/B Test",description:x.message,variant:"destructive"})}};return r?a?e.jsxs(_e.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden mb-6",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/30 rounded-lg",children:e.jsx(st,{className:"w-5 h-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"Treatment Validation & A/B Testing"}),e.jsxs("div",{className:"flex items-center gap-4 mt-1",children:[e.jsx("div",{className:"flex items-center gap-1 text-sm text-gray-500 dark:text-gray-400",children:v?e.jsxs(e.Fragment,{children:[e.jsx(kr,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:"Connected"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Nr,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{children:"Disconnected"})]})}),j&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx(wr,{className:"w-4 h-4"}),e.jsxs("span",{children:["Last sync: ",new Date(j).toLocaleString()]})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(de,{onClick:Y,disabled:c||!v,size:"sm",variant:"outline",className:"flex items-center gap-2",children:[e.jsx(_r,{className:`w-4 h-4 ${c?"animate-spin":""}`}),"Sync HR"]}),e.jsxs(de,{onClick:U,disabled:c||!v,size:"sm",className:"flex items-center gap-2",children:[e.jsx(Sr,{className:"w-4 h-4"}),"Create A/B Test"]})]})]})}),e.jsx("div",{className:"px-6 py-3 border-b border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"flex gap-1",children:[{id:"tracking",label:"Active Treatments",icon:st},{id:"effectiveness",label:"Effectiveness",icon:Tt},{id:"ab-tests",label:"A/B Tests",icon:Vt},{id:"uplift",label:"Uplift",icon:Tt}].map(x=>e.jsxs("button",{onClick:()=>m(x.id),className:`px-4 py-2 text-sm font-medium rounded-lg transition-colors flex items-center gap-2 ${d===x.id?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"}`,children:[e.jsx(x.icon,{className:"w-4 h-4"}),x.label]},x.id))})}),e.jsx("div",{className:"p-6",children:e.jsxs(Cr,{mode:"wait",children:[d==="tracking"&&e.jsxs(_e.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:t?`Treatments for ${t.name}`:"Select an employee to view treatments"}),t&&p.length>0?e.jsx("div",{className:"space-y-3",children:p.map(x=>e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 border border-gray-200 dark:border-gray-600",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:x.treatment_name}),e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${x.status==="completed"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300":x.status==="active"?"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300":x.status==="applied"?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-300":"bg-gray-100 text-gray-700 dark:bg-gray-600 dark:text-gray-300"}`,children:x.status}),e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${x.ab_group==="treatment"?"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-300":"bg-gray-100 text-gray-700 dark:bg-gray-600 dark:text-gray-300"}`,children:x.ab_group})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Applied:"}),e.jsx("p",{className:"font-medium",children:new Date(x.applied_date).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Predicted Impact:"}),e.jsxs("p",{className:"font-medium",children:[(x.predicted_churn_reduction*100).toFixed(1),"%"]})]}),!s&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Cost:"}),e.jsxs("p",{className:"font-medium",children:["$",x.actual_cost||x.predicted_cost]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Predicted ROI:"}),e.jsxs("p",{className:"font-medium",children:[x.predicted_roi.toFixed(1),"x"]})]})]})]})})},x.id))}):t?e.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"No treatments applied to this employee yet"}):e.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"Select an employee from the list to view their treatment history"})]},"tracking"),d==="effectiveness"&&e.jsxs(_e.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:"Treatment Effectiveness Analysis"}),k.length>0?e.jsx("div",{className:"space-y-4",children:k.map((x,$)=>e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 border border-gray-200 dark:border-gray-600",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-gray-100",children:x.treatment_name}),e.jsxs("div",{className:"flex items-center gap-2",children:[x.statistical_significance&&e.jsx(Pr,{className:"w-4 h-4 text-green-500"}),e.jsxs("span",{className:`px-2 py-1 text-xs rounded-full ${x.effectiveness_rate>.7?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300":x.effectiveness_rate>.5?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-300":"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300"}`,children:[(x.effectiveness_rate*100).toFixed(1),"% effective"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Applications:"}),e.jsx("p",{className:"font-medium",children:x.total_applications})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Successful:"}),e.jsx("p",{className:"font-medium text-green-600 dark:text-green-400",children:x.successful_retentions})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Avg Cost:"}),e.jsxs("p",{className:"font-medium",children:["$",x.average_cost.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"ROI Ratio:"}),e.jsxs("p",{className:"font-medium",children:[x.roi_ratio.toFixed(1),"x"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Sample Size:"}),e.jsx("p",{className:"font-medium",children:x.sample_size})]})]})]},$))}):e.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"No effectiveness data available yet. Apply treatments and sync with HR to see results."})]},"effectiveness"),d==="ab-tests"&&e.jsxs(_e.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:"A/B Test Results"}),N.length>0?e.jsx("div",{className:"space-y-6",children:Object.entries(N.reduce((x,$)=>(x[$.test_name]||(x[$.test_name]=[]),x[$.test_name].push($),x),{})).map(([x,$])=>e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 border border-gray-200 dark:border-gray-600",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-gray-100 mb-3",children:x}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:$.map(M=>e.jsxs("div",{className:`p-3 rounded border ${M.group_assignment==="treatment"?"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800":"bg-gray-100 dark:bg-gray-600/50 border-gray-300 dark:border-gray-500"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"font-medium capitalize",children:[M.group_assignment," Group"]}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[M.group_size," employees"]})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Retained:"}),e.jsx("span",{className:"font-medium text-green-600 dark:text-green-400",children:M.retained_count})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Churned:"}),e.jsx("span",{className:"font-medium text-red-600 dark:text-red-400",children:M.churned_count})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Retention Rate:"}),e.jsxs("span",{className:"font-medium",children:[M.retention_rate.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Avg Baseline Risk:"}),e.jsxs("span",{className:"font-medium",children:[(M.avg_baseline_risk*100).toFixed(1),"%"]})]})]})]},`${x}-${M.group_assignment}`))}),$.length===2&&e.jsx("div",{className:"mt-4 p-3 bg-white dark:bg-gray-800 rounded border",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Treatment Effect: "}),(()=>{const M=$.find(J=>J.group_assignment==="treatment"),se=$.find(J=>J.group_assignment==="control");if(M&&se){const J=M.retention_rate-se.retention_rate;return e.jsxs("span",{className:`font-medium ${J>0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[J>0?"+":"",J.toFixed(1),"% retention improvement"]})}return"Calculating..."})()]})})]},x))}):e.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"No A/B tests created yet. Create a test to compare treatment effectiveness."})]},"ab-tests"),d==="uplift"&&e.jsxs(_e.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"Uplift Summary"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold mb-2",children:"Baseline (Diff-in-Proportions)"}),e.jsx("div",{className:"overflow-x-auto border border-gray-200 dark:border-gray-700 rounded",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-2 text-left",children:"Treatment"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"T"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"C"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Rate T"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Rate C"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Uplift"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"95% CI"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"p"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Power≥80%"})]})}),e.jsx("tbody",{children:T.length===0?e.jsx("tr",{children:e.jsx("td",{className:"px-2 py-3 text-gray-500",colSpan:9,children:"No data"})}):T.map((x,$)=>e.jsxs("tr",{className:"border-t border-gray-200 dark:border-gray-700",children:[e.jsx("td",{className:"px-2 py-2",children:x.treatment_name}),e.jsx("td",{className:"px-2 py-2 text-right",children:x.n_treatment}),e.jsx("td",{className:"px-2 py-2 text-right",children:x.n_control}),e.jsxs("td",{className:"px-2 py-2 text-right",children:[(x.retention_rate_t*100).toFixed(1),"%"]}),e.jsxs("td",{className:"px-2 py-2 text-right",children:[(x.retention_rate_c*100).toFixed(1),"%"]}),e.jsxs("td",{className:"px-2 py-2 text-right",children:[(x.uplift*100).toFixed(1),"%"]}),e.jsxs("td",{className:"px-2 py-2 text-right",children:["[",(x.ci_low*100).toFixed(1),"%, ",(x.ci_high*100).toFixed(1),"%]"]}),e.jsx("td",{className:"px-2 py-2 text-right",children:x.p_value?.toFixed(3)}),e.jsx("td",{className:"px-2 py-2 text-right",children:x.power_80?"Yes":"No"})]},$))})]})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold mb-2",children:"CUPED-Adjusted"}),e.jsx("div",{className:"overflow-x-auto border border-gray-200 dark:border-gray-700 rounded",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-2 text-left",children:"Treatment"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Uplift (CUPED)"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"θ"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Variance Reduction"})]})}),e.jsx("tbody",{children:V.length===0?e.jsx("tr",{children:e.jsx("td",{className:"px-2 py-3 text-gray-500",colSpan:4,children:"No data"})}):V.map((x,$)=>e.jsxs("tr",{className:"border-t border-gray-200 dark:border-gray-700",children:[e.jsx("td",{className:"px-2 py-2",children:x.treatment_name}),e.jsxs("td",{className:"px-2 py-2 text-right",children:[(x.uplift_cuped*100).toFixed(1),"%"]}),e.jsx("td",{className:"px-2 py-2 text-right",children:x.cuped_theta?.toFixed(3)}),e.jsxs("td",{className:"px-2 py-2 text-right",children:[((x.cuped_variance_reduction||0)*100).toFixed(1),"%"]})]},$))})]})}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"CUPED adjusts for baseline differences to reduce variance."})]})]},"uplift")]})})]}):e.jsx(_e.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-xl p-6 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-amber-100 dark:bg-amber-900/40 rounded-full",children:e.jsx(jr,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-amber-900 dark:text-amber-100",children:"Database Connection Required"}),e.jsx("p",{className:"text-sm text-amber-700 dark:text-amber-300 mt-1",children:"Treatment tracking requires an active database connection to your HR system. Connect to enable real-time validation and A/B testing."})]})]})}):null};function qs(){const[t,r]=n.useState(Or()),[a]=n.useState($r()),[s,l]=n.useState(!1),[c,u]=n.useState(null);n.useEffect(()=>Dr(p=>{r(p),u(null)}),[]);const d=n.useCallback(async(m,p=!1)=>{l(!0),u(null);try{return await Fr(m,p)}catch(g){const k=g instanceof Error?g.message:"Auto-adjustment failed";return u(k),{adjusted:!1,reason:k}}finally{l(!1)}},[]);return{config:t,thresholds:t.current,autoConfig:a,autoAdjust:d,getRiskLevel:Mr,getRiskLevelWithStyles:Vr,calculateRiskDistribution:zr,isLoading:s,error:c}}function le(t){return t==null||isNaN(t)?"$0.00":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(t)}function dr(t){return t>=1e5?"high":t>=5e4?"medium":"low"}function fe(t,r){if(r==="quality"){const a=dr(t);return a.charAt(0).toUpperCase()+a.slice(1)}return le(t)}function ct(t){const r=dr(t);return r==="high"?"text-emerald-600 dark:text-emerald-400":r==="medium"?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400"}function Oe(t,r){return!r||r<=0?0:t/r*100}function Le(t){return`${t.toFixed(1)}%`}function Js({content:t,children:r,position:a="top",disabled:s=!1}){const[l,c]=n.useState(!1),u=n.useRef(null),[d,m]=n.useState({top:0,left:0}),[p,g]=n.useState(""),k=!0,w=n.useCallback(()=>{const N=u.current;if(!N)return;const f=N.getBoundingClientRect(),j=8;a==="top"?(m({top:f.top-j,left:f.left+f.width/2}),g("-translate-x-1/2 -translate-y-full")):a==="right"?(m({top:f.top+f.height/2,left:f.right+j}),g("-translate-y-1/2")):a==="bottom"?(m({top:f.bottom+j,left:f.left+f.width/2}),g("-translate-x-1/2")):(m({top:f.top+f.height/2,left:f.left-j}),g("-translate-y-1/2 -translate-x-full"))},[a]);return n.useEffect(()=>{if(!l)return;w();const N=()=>w(),f=()=>w();return window.addEventListener("scroll",N,!0),window.addEventListener("resize",f),()=>{window.removeEventListener("scroll",N,!0),window.removeEventListener("resize",f)}},[l,w]),e.jsxs("div",{ref:u,className:"relative inline-block",onMouseEnter:()=>!s&&k&&c(!0),onMouseLeave:()=>!s&&k&&c(!1),children:[r,l&&!s&&k&&ut.createPortal(e.jsx("div",{className:je("fixed z-[9999] px-2 py-1 text-xs bg-white border border-gray-200 rounded shadow-lg whitespace-nowrap dark:bg-gray-800 dark:border-gray-700 dark:text-gray-200",p),style:{top:d.top,left:d.left},children:t}),document.body)]})}function dt({title:t,children:r,content:a,position:s="top"}){const[l,c]=n.useState(!1),u=n.useRef(null),d=n.useRef(null),[m,p]=n.useState({top:0,left:0}),[g,k]=n.useState(""),w=n.useCallback(()=>{const N=u.current;if(!N)return;const f=N.getBoundingClientRect(),j=10;s==="top"?(p({top:f.top-j,left:f.left+f.width/2}),k("-translate-x-1/2 -translate-y-full")):s==="right"?(p({top:f.top+f.height/2,left:f.right+j}),k("-translate-y-1/2")):s==="bottom"?(p({top:f.bottom+j,left:f.left+f.width/2}),k("-translate-x-1/2")):(p({top:f.top+f.height/2,left:f.left-j}),k("-translate-y-1/2 -translate-x-full"))},[s]);return n.useEffect(()=>{if(!l)return;w();const N=()=>w(),f=()=>w(),j=v=>{!d.current||!u.current||d.current.contains(v.target)||u.current.contains(v.target)||c(!1)},I=v=>{v.key==="Escape"&&c(!1)};return window.addEventListener("scroll",N,!0),window.addEventListener("resize",f),window.addEventListener("mousedown",j),window.addEventListener("keydown",I),()=>{window.removeEventListener("scroll",N,!0),window.removeEventListener("resize",f),window.removeEventListener("mousedown",j),window.removeEventListener("keydown",I)}},[l,w]),e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",ref:u,onClick:()=>c(N=>!N),"aria-expanded":l,"aria-label":`${t} info`,className:"inline-flex items-center justify-center focus:outline-none focus:ring-2 focus:ring-blue-500/40 rounded",children:r}),l&&ut.createPortal(e.jsxs("div",{ref:d,className:je("fixed z-[10000] max-w-xs sm:max-w-sm md:max-w-md p-3 sm:p-3.5 rounded-lg shadow-xl border backdrop-blur bg-white/95 dark:bg-gray-900/95 border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-200",g),style:{top:m.top,left:m.left},role:"dialog","aria-modal":"true",children:[e.jsxs("div",{className:"flex items-start gap-2 mb-2",children:[e.jsx(Ve,{className:"w-4 h-4 text-blue-500 mt-0.5"}),e.jsx("h4",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:t}),e.jsx("button",{onClick:()=>c(!1),className:"ml-auto text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:"×"})]}),e.jsx("div",{className:"text-xs leading-5 space-y-2",children:a})]}),document.body)]})}const Zs=n.memo(({treatment:t,onSelect:r,isSelected:a=!1,isLoading:s=!1,employeeSalary:l=0})=>{const c=typeof window<"u"&&localStorage.getItem("settings.dataMode")==="performance",u=g=>`${g<0?"−":"+"}${Math.abs(g*100).toFixed(1)}%`,d=g=>!g||typeof g!="string"?"Unknown":g.charAt(0).toUpperCase()+g.slice(1),m=g=>!g||typeof g!="string"?"text-gray-500 dark:text-gray-400":g==="high"?"text-emerald-600 dark:text-emerald-400":g==="medium"?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400",p=t.name.toLowerCase().includes("salary increase")||t.name.toLowerCase().includes("salary adjustment");return e.jsxs(_e.div,{className:`group relative overflow-hidden rounded-xl transition-all duration-500 cursor-pointer ${a?"bg-gradient-to-br from-blue-500/10 via-purple-500/5 to-blue-500/10 border-2 border-blue-400/50 shadow-xl shadow-blue-500/20":"bg-gradient-to-br from-white via-gray-50/50 to-white dark:from-gray-800 dark:via-gray-800/80 dark:to-gray-800 border border-gray-200/60 dark:border-gray-700/60 hover:border-blue-300/50 dark:hover:border-blue-600/50 hover:shadow-lg hover:shadow-blue-500/10"}`,onClick:()=>{!s&&r(t)},whileHover:{scale:1.01,transition:{type:"tween",duration:.15}},whileTap:{scale:.99,transition:{type:"tween",duration:.1}},initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2,ease:"easeOut"},style:{willChange:"transform",backfaceVisibility:"hidden"},children:[e.jsx("div",{className:"absolute inset-0 bg-blue-50/50 dark:bg-blue-900/10 opacity-0 group-hover:opacity-100 transition-opacity duration-200"}),s&&e.jsx("div",{className:"absolute inset-0 bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm flex items-center justify-center rounded-xl z-50",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-5 h-5 text-blue-500 animate-spin"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Applying..."})]})}),e.jsxs("div",{className:"relative z-10 p-5 flex flex-col",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${a?"bg-blue-400":"bg-gray-300 dark:bg-gray-600"} transition-colors`}),e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100 text-base leading-tight break-words",children:t.name})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 leading-relaxed break-words whitespace-pre-line",children:t.description})]}),e.jsx("div",{className:`flex-shrink-0 w-3 h-3 rounded-full ${a?"bg-blue-500 shadow-lg shadow-blue-500/50":"bg-gray-300 dark:bg-gray-600"} transition-all duration-300`})]}),(t.timeToEffect||t.riskLevels&&t.riskLevels.length>0)&&e.jsxs("div",{className:"flex items-center gap-2 text-xs mb-4 flex-wrap",children:[t.timeToEffect&&e.jsxs("span",{className:"inline-flex items-center gap-1.5 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 px-2.5 py-1 rounded-lg border border-blue-200 dark:border-blue-800 whitespace-normal break-words",children:[e.jsx(Ve,{size:12}),e.jsxs("span",{className:"font-medium",children:["Effect: ",t.timeToEffect]})]}),t.riskLevels&&t.riskLevels.length>0&&e.jsxs("span",{className:"inline-flex items-center gap-1.5 bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300 px-2.5 py-1 rounded-lg border border-amber-200 dark:border-amber-800 whitespace-normal break-words",children:[e.jsx(He,{size:12}),e.jsxs("span",{className:"font-medium",children:["Best for: ",t.riskLevels.join(", ")," risk"]})]})]}),t.explanation&&t.explanation.length>0&&t.explanation[0].ruleId==="llm"&&e.jsxs("div",{className:"mb-4 p-4 bg-gradient-to-r from-indigo-50 via-purple-50 to-blue-50 dark:from-indigo-900/20 dark:via-purple-900/20 dark:to-blue-900/20 rounded-xl border border-indigo-200/50 dark:border-indigo-700/50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-lg bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center",children:e.jsx(Ar,{size:14,className:"text-white"})}),e.jsx("h4",{className:"text-sm font-semibold text-indigo-800 dark:text-indigo-200",children:"AI Reasoning"})]}),e.jsx("p",{className:"text-sm text-indigo-700 dark:text-indigo-300 leading-relaxed pl-2 border-l-2 border-indigo-300 dark:border-indigo-600 break-words",children:t.explanation[0].reason})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 mb-5",children:[e.jsxs("div",{className:"bg-gradient-to-br from-emerald-50 to-emerald-100/50 dark:from-emerald-900/20 dark:to-emerald-900/10 rounded-lg p-3 border border-emerald-200/50 dark:border-emerald-800/50",children:[e.jsx("p",{className:"text-xs font-medium text-emerald-600 dark:text-emerald-400 mb-1 whitespace-pre-wrap leading-snug",children:"Churn Impact"}),e.jsx("p",{className:`text-sm font-bold ${t.projected_churn_prob_change<=0?"text-emerald-700 dark:text-emerald-300":"text-red-700 dark:text-red-300"}`,children:u(t.projected_churn_prob_change)}),e.jsxs("p",{className:"text-xs text-emerald-600/70 dark:text-emerald-400/70 mt-0.5",children:["~",Math.abs((t.effectSize||0)*100).toFixed(0),"% reduction"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100/50 dark:from-blue-900/20 dark:to-blue-900/10 rounded-lg p-3 border border-blue-200/50 dark:border-blue-800/50",children:[e.jsx("p",{className:"text-xs font-medium text-blue-600 dark:text-blue-400 mb-1 whitespace-pre-wrap leading-snug",children:"ROI"}),e.jsx("p",{className:`text-sm font-bold ${m(t.projected_roi)}`,children:d(t.projected_roi)}),e.jsx("p",{className:"text-xs text-blue-600/70 dark:text-blue-400/70 mt-0.5",children:p?"over 3 years":"one-time"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100/50 dark:from-gray-800/20 dark:to-gray-800/10 rounded-lg p-3 border border-gray-200/50 dark:border-gray-700/50",children:[e.jsx("p",{className:"text-xs font-medium text-gray-600 dark:text-gray-400 mb-1 whitespace-pre-wrap leading-snug",children:"Cost"}),e.jsx("p",{className:"text-sm font-bold text-gray-800 dark:text-gray-200",children:Le(Oe(t.cost,l))}),e.jsx("p",{className:"text-xs text-gray-600/70 dark:text-gray-400/70 mt-0.5",children:"of annual salary"})]})]}),e.jsx("div",{className:"bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-lg p-3 mb-4 border border-purple-200/50 dark:border-purple-700/50",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx("p",{className:"text-xs font-medium text-purple-600 dark:text-purple-400",children:c?"Expected RVI Post-Treatment":"Expected ELTV Post-Treatment"}),e.jsx(dt,{title:c?"RVI Post‑Treatment":"ELTV Post‑Treatment",content:e.jsx(e.Fragment,{children:c?e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["Expected ",e.jsx("strong",{children:"RVI"})," category after applying the selected treatment."]}),e.jsx("p",{children:"Uses the treatment’s predicted churn reduction to update retention and re‑rank value into categories."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["Projected ",e.jsx("strong",{children:"ELTV"})," after treatment using the updated survival curve and discounting."]}),e.jsx("p",{children:"Note: display does not subtract treatment cost; ROI reflects cost separately."})]})}),children:e.jsx(Ve,{className:"w-3.5 h-3.5 text-purple-500 cursor-pointer"})})]}),e.jsx("p",{className:je("text-lg font-bold",c?ct(t.projected_post_eltv||0):"text-purple-800 dark:text-purple-200"),title:`Raw value: ${t.projected_post_eltv}, Treatment ID: ${t.id}`,children:c?fe(t.projected_post_eltv||0,"quality"):fe(t.projected_post_eltv||0,"quantification")})]}),e.jsx(nt,{className:"w-5 h-5 text-purple-500 flex-shrink-0"})]})})]}),e.jsx("button",{className:`mt-auto w-full py-3 px-4 rounded-xl font-medium transition-all duration-300 flex items-center justify-center gap-2 ${s?"bg-gray-200 dark:bg-gray-700 text-gray-500 dark:text-gray-400 cursor-wait":a?"bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg shadow-blue-500/25 hover:shadow-xl hover:shadow-blue-500/30":"bg-gradient-to-r from-gray-100 to-gray-200 dark:from-gray-700 dark:to-gray-600 text-gray-800 dark:text-gray-200 hover:from-blue-50 hover:to-purple-50 dark:hover:from-blue-900/30 dark:hover:to-purple-900/30 hover:text-blue-700 dark:hover:text-blue-300 border border-gray-300 dark:border-gray-600"}`,onClick:g=>{g.stopPropagation(),s||r(t)},disabled:s,children:s?e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm sm:text-base leading-tight text-center",children:"Applying..."})]}):a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-white/20 flex items-center justify-center",children:e.jsx("div",{className:"w-2 h-2 rounded-full bg-white"})}),e.jsx("span",{className:"text-sm sm:text-base leading-tight text-center",children:"Applied"})]}):e.jsxs(e.Fragment,{children:[e.jsx(nt,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm sm:text-base leading-tight text-center",children:"Apply Treatment"})]})})]})]})}),Ae=5,Ge=["#3b82f6","#ef4444","#10b981","#f59e0b","#8b5cf6","#ec4899"],ur=t=>{if(!t)return null;try{return structuredClone(t)}catch{return JSON.parse(JSON.stringify(t))}},mr=t=>{const r=`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`;return`scenario-${t}-${r}`};function on(){const{toast:t}=Bt(),{reportError:r}=Br(),{activeProject:a}=Wt(),s=Wr(),l=s.trainingStatus,c=n.useMemo(()=>(s.playgroundEmployees||[]).some(i=>i?.hasReasoningData||typeof i?.reasoningChurnRisk=="number"),[s.playgroundEmployees]),u=l?.status==="complete"||c,d=Ir(),m=typeof window<"u"&&localStorage.getItem("settings.dataMode")==="performance",{getRiskLevel:p}=qs(),[g,k]=n.useState("scenario"),[w,N]=n.useState(!1);n.useEffect(()=>{const i=async()=>{try{if(!a)return;const y=await Hr.getEmployees(a.name);N(y&&y.length>0)}catch{N(!1)}};i();const h=setInterval(i,3e4);return()=>clearInterval(h)},[]);const[f,j]=n.useState([]),[I,v]=n.useState(1),[_,T]=n.useState([]),[W,V]=n.useState(!1),[Q,L]=n.useState({riskLevel:"",department:"",minELTVGain:0}),[O,Y]=n.useState(new Set),[U,x]=n.useState(!1),[$,M]=n.useState({completed:0,total:0,successful:0,failed:0}),[se,J]=n.useState(!1),pe=n.useRef(!1),[A,Se]=n.useState(null),me=n.useCallback((i,h)=>{T(y=>y.map(S=>S.employee.hr_code===i?h(S):S))},[T]),ce=n.useCallback(async(i,h)=>{const y=h?.treatment??i.topTreatment,S=h?.silent??!1,C=i.employee.full_name||i.employee.name||i.employee.hr_code;if(!y)return S||t({title:"No Treatment Available",description:"Select a treatment option before applying.",variant:"destructive"}),null;me(i.employee.hr_code,z=>({...z,isApplying:!0,lastError:null}));try{const P=(await ee.post("/playground/simulate",{employee_id:i.employee.hr_code,treatment_id:y.id})).data;if(!P)throw new Error("No response returned from treatment service.");if(me(i.employee.hr_code,R=>{const q=R.playgroundData?{...R.playgroundData,current_churn_probability:P.post_churn_probability??R.playgroundData.current_churn_probability,current_eltv:P.eltv_post_treatment??R.playgroundData.current_eltv,current_survival_probabilities:P.new_survival_probabilities??R.playgroundData.current_survival_probabilities}:R.playgroundData,ae=P.pre_churn_probability!=null&&P.post_churn_probability!=null?Math.max(0,P.pre_churn_probability-P.post_churn_probability):R.potentialChurnReduction??0,Te=fe(P.eltv_post_treatment??q?.current_eltv??0,"quality"),Be=R.employeeSalaryReference||R.employee.salary||q?.current_features?.employee_cost||0,oe=Oe(P.treatment_cost??y.cost??0,Be);return{...R,isApplying:!1,lastResult:P,lastError:null,topTreatment:y,potentialELTVGain:P.treatment_effect_eltv??R.potentialELTVGain,potentialChurnReduction:ae,projectedPostRviCategory:Te,costPercentage:Number.isFinite(oe)&&oe>0?oe:R.costPercentage,employeeSalaryReference:Be||R.employeeSalaryReference,playgroundData:q}}),Y(R=>{if(!R.has(i.employee.hr_code))return R;const q=new Set(R);return q.delete(i.employee.hr_code),q}),!S)if(m){const R=P.pre_churn_probability!=null&&P.post_churn_probability!=null?Math.max(0,P.pre_churn_probability-P.post_churn_probability):null,q=R!==null?`${(R*100).toFixed(1)}% churn drop`:"Churn drop recorded",ae=fe(P.eltv_post_treatment??i.playgroundData.current_eltv??0,"quality");t({title:`Treatment applied to ${C}`,description:`${q} • RVI ${ae}`})}else{const R=P.treatment_effect_eltv??0,q=(P.roi??0)*100;t({title:`Treatment applied to ${C}`,description:`${le(R)} ELTV gain • ROI ${q.toFixed(1)}%`})}return P}catch(z){const P=z?.message||"Failed to apply treatment.";throw me(i.employee.hr_code,R=>({...R,isApplying:!1,lastError:P})),S||t({title:"Error applying treatment",description:P,variant:"destructive"}),z}},[t,me,Y,m]),$e=n.useCallback(async()=>{const i=_.filter(C=>O.has(C.employee.hr_code));if(i.length===0){t({title:"No Selection",description:"Please select employees to apply treatments to.",variant:"destructive"});return}x(!0),J(!1),pe.current=!1,M({completed:0,total:i.length,successful:0,failed:0});let h=0,y=0;const S=[];for(const C of i){if(pe.current){J(!0);break}const z=C.employee.full_name||C.employee.name||C.employee.hr_code;M({completed:h,total:i.length,currentEmployee:`→ ${z}`,successful:y,failed:S.length});try{await ce(C,{silent:!0}),h+=1,y+=1,M({completed:h,total:i.length,currentEmployee:`✓ ${z}`,successful:y,failed:S.length})}catch(P){h+=1;const R=P?.message||"Unknown error occurred";S.push({employee:z,error:R}),r(P,`Bulk Treatment - ${z}`,{employeeHrCode:C.employee.hr_code,treatmentId:C.topTreatment?.id}),M({completed:h,total:i.length,currentEmployee:`⚠ ${z}`,successful:y,failed:S.length})}if(pe.current){J(!0);break}}if(x(!1),M(C=>({...C,currentEmployee:void 0})),pe.current){t({title:"Bulk treatment cancelled",description:`Completed ${y} applications before cancellation.`});return}if(S.length>0){const C=S.slice(0,3).map(z=>z.employee).join(", ");t({title:"Bulk treatment completed with issues",description:`${y} succeeded, ${S.length} failed.${C?` Issues: ${C}${S.length>3?"…":""}`:""}`,variant:"destructive",duration:8e3})}else t({title:"Bulk treatment applied",description:`Successfully applied treatments to ${y} employees.`})},[ce,_,r,O,t]),xe=n.useCallback(()=>{pe.current=!0,J(!0),t({title:"Cancelling Operation",description:"Bulk treatment will stop after the current employee.",variant:"default"})},[t]),Ce=n.useRef(!1),[ne,De]=n.useState(null),[o,E]=n.useState(null),[G,H]=n.useState([]),[b,D]=n.useState(null),[B,K]=n.useState(!0),[Z,F]=n.useState(!1),[te,be]=n.useState(!1),[ke,Ne]=n.useState(null),[ge,Ze]=n.useState(""),[re,Ye]=n.useState(""),[X,ft]=n.useState(""),[ie,bt]=n.useState(""),[Ee,vt]=n.useState("risk"),[Xe,jt]=n.useState(!1),[kt,pr]=n.useState(null),Qe=n.useCallback(async i=>{if(!A)return;const h=ur(ne);be(!0),E(i);try{const S=(await ee.post("/playground/simulate",{employee_id:A.hr_code,treatment_id:i.id})).data;if(D(S),S&&(De(C=>C&&{...C,current_churn_probability:S.post_churn_probability??C.current_churn_probability,current_eltv:S.eltv_post_treatment??C.current_eltv,current_survival_probabilities:S.new_survival_probabilities??C.current_survival_probabilities}),Se(C=>C&&{...C,churnProbability:S.post_churn_probability??C.churnProbability,currentELTV:S.eltv_post_treatment??C.currentELTV}),h)){let C=!1,z=!1;j(P=>{const R=P.findIndex(oe=>oe.employeeId===A.hr_code&&oe.treatmentId===i.id);if(R!==-1){const oe=[...P];return oe[R]={...oe[R],data:h,treatmentId:i.id,treatmentResult:S},oe}if(P.length>=Ae)return z=!0,P;const q=i.name?.trim()||`Scenario ${I}`,ae=P.filter(oe=>oe.name===q||oe.name.startsWith(`${q} (`)).length,Te=ae===0?q:`${q} (${ae+1})`,Be={id:mr(I),name:Te,color:Ge[(I-1)%Ge.length],employeeId:A.hr_code,treatmentId:i.id,data:h,treatmentResult:S};return C=!0,[...P,Be]}),C?v(P=>P+1):z&&t({title:"Scenario limit reached",description:`You can only keep up to ${Ae} scenarios at a time. Remove one before adding another.`,variant:"destructive"})}t({title:"Treatment Applied",description:`Successfully applied "${i.name}" to ${A.name}`})}catch(y){D(null),t({title:"Error",description:`Failed to apply treatment: ${y.message}`,variant:"destructive"})}finally{be(!1)}},[A,ne,t,j,I,v]),xr=[{id:"risk",label:"Risk Level"},{id:"name",label:"Name"},{id:"department",label:"Department"},{id:"eltv",label:"Current ELTV"}],gr=n.useCallback(i=>{s.playgroundEmployees&&s.playgroundEmployees.length>500?(jt(!0),setTimeout(()=>{vt(i),jt(!1)},0)):vt(i)},[s.playgroundEmployees]),[et,hr]=n.useState("");n.useEffect(()=>{const i=setTimeout(()=>{hr(ge)},300);return()=>clearTimeout(i)},[ge]);const we=n.useMemo(()=>{const i=s.playgroundEmployees;if(!i?.length)return[];let h=i.filter(y=>y.status==="Active");if(et.trim()){const y=et.toLowerCase().trim();h=h.filter(S=>S.name.toLowerCase().includes(y)||(S.position||"").toLowerCase().includes(y)||(S.department||"").toLowerCase().includes(y))}return h},[s.playgroundEmployees,et]),Nt=n.useMemo(()=>{let i=we;return ie&&(i=i.filter(h=>(h.position||"N/A")===ie)),X&&(i=i.filter(h=>{const y=h.churnProbability||0;return p(y)===X})),Array.from(new Set(i.map(h=>h.department||"N/A"))).sort()},[we,ie,X,p]),wt=n.useMemo(()=>{let i=we;return re&&(i=i.filter(h=>(h.department||"N/A")===re)),X&&(i=i.filter(h=>{const y=h.churnProbability||0;return p(y)===X})),Array.from(new Set(i.map(h=>h.position||"N/A"))).sort()},[we,re,X,p]),_t=n.useMemo(()=>{let i=we;re&&(i=i.filter(y=>(y.department||"N/A")===re)),ie&&(i=i.filter(y=>(y.position||"N/A")===ie));const h=i.map(y=>{const S=y.churnProbability||0;return p(S)});return Array.from(new Set(h)).sort()},[we,re,ie,p]),tt=n.useMemo(()=>{let i=we;return re&&(i=i.filter(h=>(h.department||"N/A")===re)),ie&&(i=i.filter(h=>(h.position||"N/A")===ie)),X&&(i=i.filter(h=>{const y=h.churnProbability||0;return p(y)===X})),i},[we,re,ie,X,p]),ve=n.useMemo(()=>{if(!tt.length)return[];const i=[...tt];return Ee==="risk"?i.sort((h,y)=>(y.churnProbability??0)-(h.churnProbability??0)):Ee==="name"?i.sort((h,y)=>h.name.localeCompare(y.name)):Ee==="department"?i.sort((h,y)=>(h.department||"").localeCompare(y.department||"")):Ee==="eltv"&&i.sort((h,y)=>(y.currentELTV??y.churnProbability??0)-(h.currentELTV??h.churnProbability??0)),i},[tt,Ee]),[Pe,St]=n.useState(null),Fe=n.useCallback(async(i,h)=>{if(Z||Pe===i)return;const y=s.playgroundEmployees?.find(z=>z.id===i);if(!y)return;F(!0),Ne(null),St(i),Se(y),De(null);const S=3;let C=null;for(let z=1;z<=S;z++)try{const[P,R]=await Promise.all([ee.get(`/playground/data/${y.hr_code}`).then(ae=>ae.data),ee.get(`/playground/treatments/${y.hr_code}`).then(ae=>ae.data)]);if(!P||!R){const ae="Incomplete data received from backend.";if(z<S){await new Promise(Te=>setTimeout(Te,500*z));continue}throw new Error(ae)}De(P);const q=R||[];if(H(q),k("scenario"),h&&q.length>0){const ae=q.find(Te=>Te.id===h);ae&&await Qe(ae)}t({title:"Data loaded successfully",description:`Loaded risk analysis data for ${y.name}.`,variant:"default"}),F(!1);return}catch(P){if(C=P,z<S){await new Promise(R=>setTimeout(R,600*z));continue}}Ne(`Failed to load data for ${y.name}: ${C?.message||"Unknown error"}`),t({title:"Error loading data",description:`Failed to load data for ${y.name}. Please try again.`,variant:"destructive"}),setTimeout(()=>{Se(null),St(null)},2e3),F(!1)},[Z,Pe,s.playgroundEmployees,t,Qe]),yr=95,fr=n.memo(({employee:i,isSelected:h,onClick:y,style:S})=>{const C=i.churnProbability??0;return e.jsxs(_e.button,{onClick:y,style:S,className:`
          w-full p-3 rounded-lg text-left
          transition-all duration-300
          ${h?"bg-gradient-to-r from-emerald-50 to-transparent dark:from-emerald-900/30 dark:to-transparent border-emerald-200 dark:border-emerald-800":"hover:bg-gray-50 dark:hover:bg-gray-800 border-transparent"}
          border relative group overflow-hidden
          dark:bg-gray-800 dark:text-gray-100
        `,whileHover:{scale:1.02},whileTap:{scale:.98},"data-employee-id":i.id,"data-component":"employee-row",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-emerald-500/5 via-transparent to-transparent dark:from-emerald-500/10 opacity-0 group-hover:opacity-100 transition-opacity duration-500"}),e.jsx("div",{className:"relative z-10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-gray-100 truncate",children:i.name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:i.position}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 truncate",children:i.department})]}),e.jsx(Kr,{riskScore:C,size:"sm",showIcon:!0})]})})]})}),Ct=n.useCallback(({index:i,style:h})=>{const y=ve[i];return y?e.jsx("div",{style:h,children:e.jsx(fr,{employee:y,isSelected:Pe===y.id,onClick:()=>Fe(y.id)},y.id)}):null},[ve,Pe,Fe]),br=n.useMemo(()=>e.jsx(Ur,{children:({height:i,width:h})=>e.jsx(Gr,{height:i,width:h,itemCount:ve.length,itemSize:yr,overscanCount:5,className:"bg-transparent dark:bg-transparent",children:Ct})}),[ve,Pe,Ct]);n.useEffect(()=>{if(!a){K(!1),Ne(null);return}(async()=>{if(!Ce.current){Ce.current=!0,K(!0),Ne(null);try{(!s.playgroundEmployees||s.playgroundEmployees.length===0)&&await s.fetchHomeData(a?.id||null)}catch{Ne("Failed to load employee list. Please try again.")}finally{K(!1),Ce.current=!1}}})()},[a,s.fetchHomeData,s.playgroundEmployees]),n.useEffect(()=>{const i=d.state;if(i?.hrCode&&s.playgroundEmployees&&s.playgroundEmployees.length>0){const h=s.playgroundEmployees.find(y=>y.hr_code===i.hrCode);h&&h.id!==Pe&&Fe(h.id,i.selectedTreatmentId)}},[d.state,s.playgroundEmployees,Fe,Pe]);const Pt=n.useCallback(()=>{if(!ne)return[];const i=Array.from({length:12},(S,C)=>C+1),h=ne.current_survival_probabilities;let y=h;return b?.new_survival_probabilities&&(y=b.new_survival_probabilities),i.map(S=>{const C=`month_${S}`,z=(h?.[C]??0)*100,P=(y?.[C]??z/100)*100;return{month:S,"Without Treatment":z,"With Treatment":P}})},[ne,b]),vr=n.useMemo(Pt,[Pt]);return B?e.jsx("div",{className:"h-full w-full flex items-center justify-center bg-gray-50 dark:bg-gray-900",children:e.jsx("div",{className:"opacity-100",children:e.jsx(he,{className:"h-8 w-8 text-blue-500 animate-spin"})})}):a?u?e.jsxs("div",{className:"h-screen w-full flex flex-col bg-gray-50 dark:bg-gray-900 overflow-hidden",children:[e.jsxs("header",{className:"flex-none bg-gradient-to-r from-gray-900 via-gray-800 to-gray-900 border-b border-gray-700/50 relative overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute inset-0 bg-[linear-gradient(to_right,#4f4f4f2e_1px,transparent_1px),linear-gradient(to_bottom,#4f4f4f2e_1px,transparent_1px)] bg-[size:14px_24px] [mask-image:radial-gradient(ellipse_60%_50%_at_50%_0%,#000_70%,transparent_100%)] opacity-40"}),e.jsx("div",{className:"absolute top-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-gray-500/50 to-transparent"})]}),e.jsx("div",{className:"max-w-[1600px] mx-auto px-6 md:px-8 relative z-10",children:e.jsxs("div",{className:"py-6 md:py-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-200 via-blue-400 to-blue-200 animate-gradient",children:localStorage.getItem("settings.dataMode")==="performance"?"Retention Value Index (RVI) Playground":"ELTV Treatment Playground"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"relative",children:[e.jsxs("span",{className:"px-2.5 py-0.5 text-xs font-medium bg-teal-500/10 text-teal-300 rounded-full border border-teal-500/20 relative z-10 flex items-center gap-1",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",className:"text-teal-400",children:[e.jsx("path",{d:"M21.2078 12.0117C21.6076 12.0053 21.9832 11.7346 21.9941 11.3333V6C21.9941 4.89543 21.101 4 20.0005 4H19.9057"}),e.jsx("path",{d:"M2.79222 11.9883C2.39235 11.9947 2.01681 12.2654 2.00586 12.6667V18C2.00586 19.1046 2.89903 20 3.99953 20H4.09431"}),e.jsx("path",{d:"M12 22C12.2106 22 12.3801 21.7531 12.3331 21.5451L11.0531 15.8311C11.0061 15.6231 10.79 15.4909 10.5742 15.5449L4.86949 17.2084C4.65367 17.2624 4.51911 17.5066 4.59327 17.7031L6.17929 21.6265C6.25346 21.823 6.49286 21.9735 6.70347 21.9275L12 20.5909L17.2965 21.9275C17.5071 21.9735 17.7465 21.823 17.8207 21.6265L19.4067 17.7031C19.4809 17.5066 19.3463 17.2624 19.1305 17.2084L13.4258 15.5449C13.21 15.4909 12.9939 15.6231 12.9469 15.8311L11.6669 21.5451C11.6199 21.7531 11.7894 22 12 22Z"}),e.jsx("path",{d:"M12 12L12 2M12 12L19 5M12 12L5 5"})]}),"Atlas by ChurnVision"]}),e.jsx("div",{className:"absolute inset-0 bg-teal-500/20 rounded-full blur-sm animate-pulse"})]}),e.jsxs("span",{className:"relative",children:[e.jsxs("span",{className:"px-2.5 py-0.5 text-xs font-medium bg-emerald-500/10 text-emerald-300 rounded-full border border-emerald-500/20 relative z-10 flex items-center gap-1",children:[e.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-emerald-400 animate-ping absolute"}),e.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-emerald-400"}),"Beta"]}),e.jsx("div",{className:"absolute inset-0 bg-emerald-500/20 rounded-full blur-sm animate-pulse"})]})]})]}),e.jsx("p",{className:"text-sm md:text-base text-gray-400 max-w-3xl mt-2",children:localStorage.getItem("settings.dataMode")==="performance"?"Simulate retention scenarios. Select an employee, choose a treatment, and see the projected impact on Retention Value Index (RVI) and churn risk.":"Simulate retention scenarios. Select an employee, choose a treatment, and see the projected impact on ELTV and churn risk."})]})})]}),e.jsx("div",{className:"px-6 md:px-8 py-4",children:e.jsx(Jr,{})}),e.jsxs("main",{className:"flex-1 flex min-h-0",children:[e.jsxs("aside",{className:"w-[340px] flex-none flex flex-col bg-white border-r border-gray-200 dark:bg-gray-900 dark:border-gray-700",children:[e.jsxs("div",{className:"flex-none p-4 border-b border-gray-100 dark:border-gray-800",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"Team Members"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[ve.length," employees found"]})]}),e.jsxs("div",{className:"flex-none p-4 border-b border-gray-100 dark:border-gray-800",children:[ke&&!Z&&e.jsxs("div",{className:"p-3 mb-3 bg-red-50 text-red-600 rounded-lg flex items-center gap-2 text-sm",children:[e.jsx(He,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("p",{children:ke})]}),e.jsxs("div",{className:"relative mb-3",children:[e.jsx(Er,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:ge,onChange:i=>Ze(i.target.value),placeholder:"Search employees...",className:"w-full pl-9 pr-4 py-2 text-sm bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all dark:bg-gray-800 dark:border-gray-700 dark:text-white dark:focus:ring-emerald-600 dark:focus:border-emerald-600"})]}),e.jsx("div",{className:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400 mb-3",children:e.jsx("div",{children:ge.trim()?e.jsxs(e.Fragment,{children:["Found ",e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-200",children:ve.length})," ",ve.length===1?"employee":"employees"]}):e.jsxs(e.Fragment,{children:[(s.playgroundEmployees||[]).length," total employees"]})})}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("select",{value:Ee,onChange:i=>gr(i.target.value),disabled:Xe,className:`w-full text-sm bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all dark:bg-gray-800 dark:border-gray-700 dark:text-white dark:focus:ring-emerald-600 dark:focus:border-emerald-600 ${Xe?"opacity-50 cursor-wait":""}`,children:xr.map(i=>e.jsxs("option",{value:i.id,children:["Sort by: ",i.label," ",Xe&&"(sorting...)"]},i.id))}),e.jsxs("select",{value:re,onChange:i=>Ye(i.target.value),className:"w-full text-sm bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all dark:bg-gray-800 dark:border-gray-700 dark:text-white dark:focus:ring-emerald-600 dark:focus:border-emerald-600",children:[e.jsxs("option",{value:"",children:["All Departments (",Nt.length,")"]}),Nt.map(i=>e.jsx("option",{value:i,children:i},i))]}),e.jsxs("select",{value:X,onChange:i=>ft(i.target.value),className:"w-full text-sm bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all dark:bg-gray-800 dark:border-gray-700 dark:text-white dark:focus:ring-emerald-600 dark:focus:border-emerald-600",children:[e.jsxs("option",{value:"",children:["All Risk Levels (",_t.length,")"]}),_t.map(i=>e.jsxs("option",{value:i,children:[i," Risk"]},i))]}),e.jsxs("select",{value:ie,onChange:i=>bt(i.target.value),className:"w-full text-sm bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all dark:bg-gray-800 dark:border-gray-700 dark:text-white dark:focus:ring-emerald-600 dark:focus:border-emerald-600",children:[e.jsxs("option",{value:"",children:["All Positions (",wt.length,")"]}),wt.map(i=>e.jsx("option",{value:i,children:i},i))]})]}),e.jsxs("div",{className:"flex flex-wrap gap-1 mb-3",children:[(re||X||ie)&&e.jsx("button",{onClick:()=>{Ye(""),ft(""),bt("")},className:"px-2 py-1 bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300 text-xs rounded-full hover:bg-red-200 dark:hover:bg-red-800/50 transition-colors",children:"Clear All"}),re&&e.jsxs("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300 text-xs rounded-full",children:["Dept: ",re]}),X&&e.jsxs("span",{className:"px-2 py-1 bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-300 text-xs rounded-full",children:["Risk: ",X]}),ie&&e.jsxs("span",{className:"px-2 py-1 bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300 text-xs rounded-full",children:["Pos: ",ie]})]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-3",children:B?e.jsx("div",{className:"space-y-2",children:Array.from({length:5}).map((i,h)=>e.jsx("div",{className:"p-4 rounded-lg border border-gray-100 dark:border-gray-800 animate-pulse h-[83px] bg-gray-100 dark:bg-gray-800"},h))}):ve.length===0?e.jsxs("div",{className:"text-center py-12 px-4",children:[e.jsx(Et,{className:"h-12 w-12 text-gray-300 dark:text-gray-700 mx-auto mb-3"}),e.jsx("h3",{className:"text-gray-900 dark:text-gray-100 font-medium mb-1",children:"No employees found"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"Try adjusting your search or filters"})]}):br})]}),e.jsx("div",{className:"flex-1 flex flex-col min-w-0 bg-gray-100/50 dark:bg-gray-800/30",children:e.jsx("div",{className:"flex flex-col p-4 md:p-6 space-y-4 h-full",children:Z?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-500 dark:text-gray-400",children:[e.jsx(he,{className:"w-8 h-8 animate-spin mb-3"}),e.jsx("p",{children:"Loading employee details..."})]}):ke&&!ne?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center p-6 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700 rounded-lg",children:[e.jsx(He,{className:"w-12 h-12 text-red-500 dark:text-red-400 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 dark:text-red-200 mb-2",children:"Error Loading Data"}),e.jsx("p",{className:"text-sm text-red-600 dark:text-red-300",children:ke})]}):e.jsxs("div",{className:"flex flex-col h-full space-y-4",children:[ne?e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 flex-shrink-0",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-3 shadow-sm relative overflow-hidden border border-gray-100 dark:border-gray-700 h-fit",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-500/5 to-transparent opacity-50 dark:opacity-20"}),e.jsx("div",{className:"relative z-10",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:localStorage.getItem("settings.dataMode")==="performance"?"Current RVI":"Current ELTV"}),e.jsx(dt,{title:localStorage.getItem("settings.dataMode")==="performance"?"What is RVI?":"What is ELTV?",content:e.jsx(e.Fragment,{children:localStorage.getItem("settings.dataMode")==="performance"?e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"RVI (Retention Value Index)"})," is a qualitative indicator (High/Medium/Low) derived from modeled retention value and churn risk signals."]}),e.jsx("p",{children:"It does not use salary in performance mode. Categories are computed from underlying ELTV ranks."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"ELTV (Employee Lifetime Value)"})," estimates the present value of expected contribution based on predicted retention over a fixed horizon with discounting, scaled by the employee’s salary."]}),e.jsx("p",{children:"Higher survival probabilities and salary yield higher ELTV."})]})}),children:e.jsx(Ve,{className:"w-3.5 h-3.5 text-gray-400 cursor-pointer"})})]}),e.jsx("div",{className:"mt-1 flex items-baseline gap-2",children:e.jsx("span",{className:je("text-xl font-semibold",localStorage.getItem("settings.dataMode")==="performance"?ct(ne.current_eltv):"text-gray-900 dark:text-gray-100"),children:localStorage.getItem("settings.dataMode")==="performance"?ne.current_eltv>0?fe(ne.current_eltv,"quality"):"N/A":fe(ne.current_eltv,"quantification")})})]}),e.jsx(Et,{className:"w-5 h-5 text-gray-400"})]})})]}),e.jsxs("div",{className:je("rounded-xl p-3 shadow-sm relative overflow-hidden border h-fit",b?"bg-blue-50 dark:bg-blue-900/30 border-blue-200 dark:border-blue-700":"bg-white dark:bg-gray-800 border-gray-100 dark:border-gray-700 opacity-60"),children:[b&&e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-500/20 to-transparent opacity-50 dark:opacity-30"}),e.jsx("div",{className:"relative z-10",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:localStorage.getItem("settings.dataMode")==="performance"?"RVI Post-Treatment":"ELTV Post-Treatment"}),e.jsx(dt,{title:localStorage.getItem("settings.dataMode")==="performance"?"RVI Post‑Treatment":"ELTV Post‑Treatment",content:e.jsx(e.Fragment,{children:localStorage.getItem("settings.dataMode")==="performance"?e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["Shows expected ",e.jsx("strong",{children:"RVI category"})," after applying the selected treatment, reflecting improved retention without salary."]}),e.jsx("p",{children:"Categories are derived from updated ELTV ranks under the treatment’s predicted churn reduction."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["Projected ",e.jsx("strong",{children:"ELTV"})," using updated survival probabilities after treatment. Display does not subtract treatment cost; cost is shown separately in ROI."]}),e.jsx("p",{children:"Depends on survival curve shape, discounting, and the employee’s salary."})]})}),children:e.jsx(Ve,{className:"w-3.5 h-3.5 text-gray-400 cursor-pointer"})})]}),e.jsx("div",{className:"mt-1 flex items-baseline gap-2",children:e.jsx(Js,{content:b?`Raw value: ${b.eltv_post_treatment}, Treatment ID: ${b.applied_treatment.id}, Treatment: ${b.applied_treatment.name}`:"No treatment applied",disabled:!b,children:e.jsx("span",{className:je("text-xl font-semibold cursor-help",b?localStorage.getItem("settings.dataMode")==="performance"?ct(b.eltv_post_treatment):"text-blue-600 dark:text-blue-400":"text-gray-400 dark:text-gray-500"),children:b?localStorage.getItem("settings.dataMode")==="performance"?fe(b.eltv_post_treatment,"quality"):fe(b.eltv_post_treatment,"quantification"):localStorage.getItem("settings.dataMode")==="performance"?"Unknown":"$ -.--"})})})]}),e.jsx(nt,{className:je("w-5 h-5",b?"text-blue-500":"text-gray-400")})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-3 shadow-sm border border-gray-100 dark:border-gray-700 col-span-1 sm:col-span-2 lg:col-span-2 h-fit",children:[e.jsx("label",{htmlFor:"budgetInput",className:"block text-sm font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Budget Constraint (Optional)"}),e.jsxs("div",{className:"relative mt-1 rounded-md shadow-sm",children:[e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3",children:e.jsx("span",{className:"text-gray-500 dark:text-gray-400 sm:text-sm",children:"%"})}),e.jsx("input",{type:"number",name:"budgetInput",id:"budgetInput",className:"block w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 pl-3 pr-8 py-2 focus:border-blue-500 focus:ring-blue-500 sm:text-sm dark:text-gray-100",placeholder:"Max % of salary (e.g., 10)",min:"0",max:"100",step:"0.1",value:kt??"",onChange:i=>{const h=i.target.value;pr(h===""?null:parseFloat(h))}})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Percentage of employee's annual salary"})]})]}):e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border border-gray-100 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-gray-100 mb-2",children:"Playground Overview"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Explore scenario planning, mass treatment, and tracking tools using the tabs below. Select an employee when you’re ready to generate personalized insights and projections."})]}),e.jsx("div",{className:"flex space-x-1 bg-gray-100 dark:bg-gray-800 p-1 rounded-lg",children:e.jsxs("button",{onClick:()=>k("scenario"),className:`flex-1 flex items-center justify-center gap-2 px-4 py-2 text-sm font-medium rounded-md transition-all ${g==="scenario"?"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"}`,children:[e.jsx(Mt,{className:"w-4 h-4"}),"Scenario Comparison"]})}),g==="scenario"?e.jsx(Ys,{scenarios:f,setScenarios:j,nextScenarioId:I,setNextScenarioId:v,selectedEmployee:A,selectedEmployeeData:ne,treatmentSuggestions:G,applyTreatment:Qe,isApplyingTreatment:te,selectedTreatment:o,isPerformanceMode:m,budget:kt,transformedChartData:vr}):g==="mass-treatment"?e.jsx(Xs,{candidates:_,setCandidates:T,isLoading:W,setIsLoading:V,isPerformanceMode:m,filters:Q,setFilters:L,employees:ve,getRiskLevel:p,toast:t,handleEmployeeSelect:Fe,setActiveTab:k,selectedCandidates:O,setSelectedCandidates:Y,isApplyingBulkTreatment:U,bulkProgress:$,applyBulkTreatment:$e,applyCandidateTreatment:ce,bulkOperationCancelled:se,cancelBulkTreatment:xe}):e.jsx("div",{className:"space-y-6",children:e.jsx(Gs,{selectedEmployee:A?{hr_code:A.hr_code,name:A.name,churn_probability:A.churnProbability}:void 0,isVisible:!0,hasDBConnection:w,isPerformanceMode:m})})]})})})]})]}):e.jsx(qr,{status:l?.status,message:l?.message}):e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center p-6 bg-gray-50 dark:bg-gray-900",children:[e.jsx(Tr,{className:"mx-auto h-16 w-16 text-gray-400 dark:text-gray-600 mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"No Project Active"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Please select or create a project to use the Playground."})]})}const Ys=n.memo(({scenarios:t,setScenarios:r,nextScenarioId:a,setNextScenarioId:s,selectedEmployee:l,selectedEmployeeData:c,treatmentSuggestions:u,applyTreatment:d,isApplyingTreatment:m,selectedTreatment:p,isPerformanceMode:g,budget:k,transformedChartData:w})=>{const N=n.useCallback(()=>{if(!l||!c||t.length>=Ae)return;const v={id:mr(a),name:`Scenario ${a}`,color:Ge[(a-1)%Ge.length],employeeId:l.hr_code,treatmentId:null,data:c,treatmentResult:null};r(_=>[..._,v]),s(_=>_+1)},[l,c,t,a,r,s]),f=n.useCallback(v=>{r(_=>_.filter(T=>T.id!==v))},[r]),j=n.useCallback(async(v,_)=>{const T=t.find(L=>L.id===v);if(!T)return;if(_===null){r(L=>L.map(O=>O.id===v?{...O,treatmentId:null,treatmentResult:null}:O));return}const W=T.treatmentId,V=T.treatmentResult,Q=ur(T.data);r(L=>L.map(O=>O.id===v?{...O,treatmentId:_,treatmentResult:null}:O));try{const O=(await ee.post("/playground/simulate",{employee_id:T.employeeId,treatment_id:_})).data;r(Y=>Y.map(U=>U.id===v?{...U,data:Q??U.data,treatmentId:_,treatmentResult:O}:U))}catch{r(O=>O.map(Y=>Y.id===v?{...Y,treatmentId:W,treatmentResult:V}:Y))}},[t,r]),I=n.useMemo(()=>t.length===0?w:Array.from({length:12},(_,T)=>T+1).map(_=>{const T=`month_${_}`,W={month:_};return t.forEach(V=>{if(V.data){const Q=(V.data.current_survival_probabilities?.[T]??0)*100,L=V.treatmentResult?(V.treatmentResult.new_survival_probabilities?.[T]??Q/100)*100:Q;W[V.name]=L}}),W}),[t,w]);return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 flex-1 min-h-0 overflow-hidden",children:[e.jsx("div",{className:"lg:col-span-2 bg-white dark:bg-gray-800/80 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700/50 flex flex-col overflow-hidden h-full min-h-0",children:e.jsxs("div",{className:"flex flex-col p-4 h-full min-h-0",children:[e.jsxs("div",{className:"mb-3 pb-2 border-b border-gray-200 dark:border-gray-700 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"Scenario Comparison - Retention Probability"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{onClick:N,disabled:!l||t.length>=Ae,title:l?t.length>=Ae?`Maximum of ${Ae} scenarios reached`:void 0:"Select an employee to add personalized scenarios",className:"px-3 py-1 text-xs bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1",children:[e.jsx(Mt,{className:"w-3 h-3"}),"Add Scenario"]})})]}),!c&&e.jsx("div",{className:"mb-3 p-3 rounded-md bg-blue-50 text-blue-700 dark:bg-blue-900/20 dark:text-blue-200 text-xs",children:"Select an employee to compare baseline versus treated retention probabilities. Until then, the chart below will stay empty."}),t.length>0&&e.jsx("div",{className:"space-y-2 mb-3",children:t.map(v=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:v.color}}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:v.name}),e.jsxs("select",{value:v.treatmentId||"",onChange:_=>{const T=_.target.value,W=T===""?null:parseInt(T,10);j(v.id,W)},className:"text-xs bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded px-2 py-1",children:[e.jsx("option",{value:"",children:"No Treatment"}),u.map(_=>{const T=l?.salary||c?.current_features.employee_cost||0,W=Oe(_.cost||0,T),V=W>0,Q=g?`${_.name}${V?` (${Le(W)} of salary)`:""}`:`${_.name} (${le(_.cost||0)})`;return e.jsx("option",{value:_.id,children:Q},_.id)})]}),e.jsx("button",{onClick:()=>f(v.id),className:"text-red-500 hover:text-red-700 ml-auto",children:"×"})]},v.id))}),c&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3",children:[e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:[e.jsx("strong",{children:"Current Risk:"})," ",(c.current_churn_probability*100).toFixed(1),"% annual churn probability"]}),e.jsx("p",{className:"text-xs text-blue-700 dark:text-blue-300 mt-1",children:"Compare different treatment scenarios side by side. Each line represents a different scenario with its applied treatment."})]})]}),e.jsx("div",{className:"flex-1",style:{height:"300px"},children:e.jsx(Ra,{width:"100%",height:300,children:e.jsxs(Us,{data:I,margin:{top:5,right:20,left:0,bottom:20},children:[e.jsx(La,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(Aa,{dataKey:"month",label:{value:"Months from Now",position:"bottom",dy:5,style:{fontSize:12,fill:"#6b7280"}},type:"number",domain:[1,12],ticks:[1,3,6,9,12],stroke:"#6b7280",tick:{fontSize:11},axisLine:{stroke:"#d1d5db"},tickLine:{stroke:"#d1d5db"}}),e.jsx(Ia,{label:{value:"Retention Probability (%)",angle:-90,position:"insideLeft",offset:-5,dx:-10,style:{fontSize:12,fill:"#6b7280"}},domain:[0,100],stroke:"#6b7280",tick:{fontSize:11},axisLine:{stroke:"#d1d5db"},tickLine:{stroke:"#d1d5db"},width:45}),e.jsx(Oa,{content:({active:v,payload:_,label:T})=>v&&_&&_.length?e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-3 border border-gray-200 dark:border-gray-600 rounded-lg shadow-lg text-xs max-w-xs",children:[e.jsxs("p",{className:"font-medium text-gray-900 dark:text-gray-100 mb-2",children:[T," months from now"]}),_.map(W=>e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:W.color}}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-300",children:[W.name,":"]}),e.jsxs("span",{className:"font-medium text-gray-800 dark:text-gray-100",children:[W.value.toFixed(1),"%"]})]},W.name))]}):null}),e.jsx(tr,{verticalAlign:"top",height:30,iconSize:8,wrapperStyle:{fontSize:"12px",paddingTop:"5px"},formatter:v=>e.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:v})}),t.map(v=>e.jsx(cr,{type:"monotone",dataKey:v.name,stroke:v.color,strokeWidth:2,dot:!1,activeDot:{r:5,strokeWidth:1,fill:v.color},name:v.name},v.id))]})})})]})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800/80 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700/50 flex flex-col h-full min-h-0",children:[e.jsx("div",{className:"flex items-center justify-between p-4 border-b border-gray-100 dark:border-gray-800 flex-shrink-0",children:e.jsx("h3",{className:"text-base font-medium text-gray-700 dark:text-gray-200",children:"AI-Generated Treatments"})}),u.length>0?e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-transparent dark:scrollbar-thumb-gray-600",style:{minHeight:"300px"},children:u.filter(v=>k===null?!0:Oe(v.cost,c?.current_features.employee_cost||0)<=k).slice(0,6).map(v=>e.jsx(Zs,{treatment:v,onSelect:d,isSelected:p?.id===v.id,isLoading:m&&p?.id===v.id,employeeSalary:c?.current_features.employee_cost||0},v.id))}):e.jsx("div",{className:"flex-1 flex items-center justify-center text-center py-8 text-gray-500 dark:text-gray-400",children:e.jsx("p",{children:c?"No treatment suggestions available for this employee.":"Select an employee to generate treatment suggestions."})})]})]})}),Xs=n.memo(({candidates:t,setCandidates:r,isLoading:a,setIsLoading:s,isPerformanceMode:l,filters:c,setFilters:u,employees:d,getRiskLevel:m,toast:p,handleEmployeeSelect:g,setActiveTab:k,selectedCandidates:w,setSelectedCandidates:N,isApplyingBulkTreatment:f,bulkProgress:j,applyBulkTreatment:I,applyCandidateTreatment:v,bulkOperationCancelled:_,cancelBulkTreatment:T})=>{const W=n.useCallback(async()=>{s(!0);try{const o=d.filter(b=>{const D=b.hr_code&&b.name,B=(b.salary||0)>=0;return D&&B}).map(b=>{const D=m(b.churnProbability||0),B=b.churnProbability||0,K=b.salary||0,Z=b.tenure||0,F=Q({churnProbability:B,salary:K,currentELTV:b.currentELTV,tenure:Z,riskLevel:D}),te=M({churnProbability:B,salary:K,tenure:Z,riskLevel:D}),be=F*.6+te*.4;return{employee:b,criticalityScore:F,efficiencyScore:te,priorityScore:be,riskLevel:D}}).filter(b=>b.priorityScore>30).sort((b,D)=>D.priorityScore-b.priorityScore).slice(0,Math.max(5,Math.floor(d.length*.1)));if(o.length===0){p({title:"No Critical Opportunities Found",description:"No employees meet the criticality and efficiency criteria. Try adjusting the analysis parameters.",variant:"destructive"});return}const E=o.map(async b=>{try{const D=b.employee,[B,K]=await Promise.all([ee.get(`/playground/data/${D.hr_code}`).then(X=>X.data),ee.get(`/playground/treatments/${D.hr_code}`).then(X=>X.data)]);if(!B||!K)return null;const Z=K.suggestions||[],F=Z.length>0?Z[0]:null,te=F?(F.projected_post_eltv||0)-(B.current_eltv||0):0,be=F?Math.max(0,-(F.projected_churn_prob_change||0)):0,ke=F?fe(F.projected_post_eltv||0,"quality"):null,Ne=D.salary||B.current_features.employee_cost||0,ge=F?Oe(F.cost||0,Ne):0,Ze=ge>0?`Cost: ${Le(ge)} of salary`:void 0,re=F?l?[`Recommended: ${F.name}`,`Estimated churn drop: ${(be*100).toFixed(1)}%`,ke?`Projected RVI: ${ke}`:void 0,Ze].filter(Boolean):[`Recommended: ${F.name}`,`Expected ELTV gain: ${le(te)}`,`Cost: ${le(F.cost||0)}`]:["No treatment recommendations available"];return{employee:D,playgroundData:B,suggestedTreatments:Z,topTreatment:F,potentialELTVGain:te,potentialChurnReduction:be,projectedPostRviCategory:ke,riskLevel:b.riskLevel,criticalityScore:b.criticalityScore,efficiencyScore:b.efficiencyScore,priorityScore:b.priorityScore,selectionCriteria:[`High priority score: ${b.priorityScore.toFixed(1)}`,`Risk level: ${b.riskLevel}`,`Churn probability: ${(b.employee.churnProbability*100).toFixed(1)}%`,...l&&be>0?[`Potential churn drop: ${(be*100).toFixed(1)}%`]:[],...l&&ge>0?[`Cost: ${Le(ge)} of salary`]:[],...!l&&te>0?[`Expected ELTV gain: ${le(te)}`]:[]],treatmentRationale:re,costPercentage:ge,employeeSalaryReference:Ne,lastResult:null,isApplying:!1,lastError:null}}catch(D){return console.error("Error analyzing employee for mass treatment:",D),null}}),H=(await Promise.all(E)).filter(b=>b!==null);r(H),N(new Set(H.slice(0,Math.min(3,H.length)).map(b=>b.employee.hr_code))),p({title:"Analysis Complete",description:`Found ${H.length} employees for potential treatment interventions.`,variant:"default"})}catch{}finally{s(!1)}},[d,m,l,s,N,p]),V=n.useMemo(()=>{let o=0,E=0,G=0,H=0,b=0,D=0,B=0;return t.forEach(K=>{const Z=Math.max(0,K.potentialELTVGain||0),F=Math.max(0,K.potentialChurnReduction||0);if(o+=Z,G+=F,w.has(K.employee.hr_code)&&(E+=Z,H+=F),K.lastResult){b+=1,D+=K.lastResult.treatment_effect_eltv??0;const te=Math.max(0,(K.lastResult.pre_churn_probability??0)-(K.lastResult.post_churn_probability??0));B+=te}}),{totalPotentialELTV:o,selectedPotentialELTV:E,totalPotentialChurn:G,selectedPotentialChurn:H,appliedCount:b,realizedGainELTV:D,realizedChurnDrop:B}},[t,w]),Q=o=>{const{churnProbability:E,salary:G,currentELTV:H=0,tenure:b}=o,D=E*40,B=Math.min(G/1e5*25,25),K=Math.min(H/2e5*20,20),Z=b>=1&&b<=5?15:b>5?10:5;return Math.min(D+B+K+Z,100)},[L,O]=n.useState({tenure:null,employee_cost:null}),[Y,U]=n.useState(null),[x,$]=n.useState(!1);n.useCallback(async o=>{try{$(!0);const E={};typeof L.tenure=="number"&&(E.tenure=L.tenure),typeof L.employee_cost=="number"&&(E.employee_cost=L.employee_cost);const H=(await ee.post("/playground/manual-simulate",{employee_id:o.hr_code,changed_features:E})).data;if(H&&typeof H=="object"){const b=H;U({post_churn_probability:Number(b?.post_churn_probability??b?.postChurnProbability??0),eltv_pre_treatment:Number(b?.pre_eltv??b?.eltv_pre_treatment??o.currentELTV??0),eltv_post_treatment:Number(b?.post_eltv??b?.eltv_post_treatment??0)})}}catch(E){console.error("What‑If simulation failed",E)}finally{$(!1)}},[L]),n.useCallback(()=>{O({tenure:null,employee_cost:null}),U(null)},[]);const M=o=>{const{churnProbability:E,tenure:G,riskLevel:H}=o;let b=0;H==="Medium"?b=30:H==="High"?b=20:H==="Low"&&(b=10);const D=G<=2?25:G<=5?20:15;let B=0;return E>=.4&&E<=.7?B=25:E>=.3&&E<=.8?B=20:B=10,Math.min(b+D+B+20,100)},se=n.useCallback(o=>{const E=new Set(w);E.has(o)?E.delete(o):E.add(o),N(E)},[w,N]),J=n.useCallback(()=>{const o=t.map(E=>E.employee.hr_code);N(new Set(o))},[t,N]),pe=n.useCallback(()=>{N(new Set)},[N]),A=w.size,[Se,me]=n.useState(!1),[ce,$e]=n.useState(""),[xe,Ce]=n.useState([]);n.useEffect(()=>{const o=localStorage.getItem("massTreatmentTemplates");if(o)try{Ce(JSON.parse(o))}catch(E){console.error("Failed to load templates:",E)}},[]);const ne=n.useCallback(()=>{if(!ce.trim()){p({title:"Template Name Required",description:"Please enter a name for your template.",variant:"destructive"});return}const o={id:Date.now().toString(),name:ce.trim(),criteria:{selectedEmployees:Array.from(w),filters:c,employeeCount:A,totalCandidates:t.length},createdAt:new Date().toISOString()},E=[...xe,o];Ce(E),localStorage.setItem("massTreatmentTemplates",JSON.stringify(E)),$e(""),me(!1),p({title:"Template Saved",description:`Template "${o.name}" saved successfully.`})},[ce,w,c,A,t.length,xe,p]),De=n.useCallback(o=>{o.criteria.selectedEmployees&&N(new Set(o.criteria.selectedEmployees)),o.criteria.filters&&u(o.criteria.filters),p({title:"Template Loaded",description:`Template "${o.name}" loaded successfully.`})},[u,p]);return n.useCallback((o,E)=>{const G=xe.filter(H=>H.id!==o);Ce(G),localStorage.setItem("massTreatmentTemplates",JSON.stringify(G)),p({title:"Template Deleted",description:`Template "${E}" deleted successfully.`})},[xe,p]),e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Mass Treatment Analysis"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Identify and prioritize employees for retention efforts."}),f&&j.total>0&&e.jsxs("div",{className:"mt-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-4 w-4 animate-spin text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-900 dark:text-blue-100",children:_?"Cancelling...":"Applying Treatments"})]}),e.jsxs("span",{className:"text-sm text-blue-700 dark:text-blue-300",children:["(",j.completed,"/",j.total,")"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-sm font-medium text-blue-700 dark:text-blue-300",children:[Math.round(j.completed/j.total*100),"%"]}),!_&&e.jsx(de,{size:"sm",variant:"outline",onClick:T,className:"h-6 px-2 text-xs border-red-300 text-red-600 hover:bg-red-50 hover:text-red-700",children:"Cancel"})]})]}),e.jsx("div",{className:"w-full bg-blue-200 dark:bg-blue-800 rounded-full h-3 mb-3",children:e.jsx("div",{className:"bg-blue-600 dark:bg-blue-400 h-3 rounded-full transition-all duration-300 flex items-center justify-end pr-2",style:{width:`${Math.max(8,j.completed/j.total*100)}%`},children:j.completed>0&&e.jsxs("span",{className:"text-xs text-white font-medium",children:[Math.round(j.completed/j.total*100),"%"]})})}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[(j.successful??0)>0&&e.jsxs("span",{className:"text-green-600 dark:text-green-400 flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full"}),j.successful," successful"]}),(j.failed??0)>0&&e.jsxs("span",{className:"text-red-600 dark:text-red-400 flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-red-500 rounded-full"}),j.failed," failed"]})]}),e.jsx("div",{className:"text-blue-700 dark:text-blue-300",children:j.currentEmployee&&e.jsxs("span",{children:["Current: ",j.currentEmployee]})})]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 p-3",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400",children:"Candidates analyzed"}),e.jsx("div",{className:"mt-1 text-2xl font-semibold text-gray-900 dark:text-gray-100",children:t.length}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[V.appliedCount," already applied"]})]}),e.jsxs("div",{className:"rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 p-3",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400",children:l?"Potential churn reduction":"Potential ELTV gain"}),e.jsx("div",{className:"mt-1 text-2xl font-semibold text-emerald-600 dark:text-emerald-400",children:l?`${(V.totalPotentialChurn*100).toFixed(1)}%`:le(V.totalPotentialELTV)}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Selected: ",l?`${(V.selectedPotentialChurn*100).toFixed(1)}%`:le(V.selectedPotentialELTV)]})]}),e.jsxs("div",{className:"rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 p-3",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400",children:l?"Realized churn drop":"Realized impact"}),e.jsx("div",{className:"mt-1 text-2xl font-semibold text-blue-600 dark:text-blue-400",children:l?`${(V.realizedChurnDrop*100).toFixed(1)}%`:le(V.realizedGainELTV)}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[w.size," selected"]})]})]}),e.jsxs("div",{className:"mt-4 flex flex-wrap items-center gap-3",children:[e.jsxs(de,{onClick:W,disabled:a||f,children:[a?e.jsx(he,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(Rr,{className:"mr-2 h-4 w-4"}),"Analyze Team"]}),t.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(de,{onClick:()=>I(),disabled:A===0||f,variant:"default",className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:[f?e.jsx(he,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(st,{className:"mr-2 h-4 w-4"}),"Apply to Selected (",A,")"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(de,{onClick:J,variant:"outline",size:"sm",children:"Select All"}),e.jsx(de,{onClick:pe,variant:"outline",size:"sm",disabled:A===0,children:"Deselect All"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(de,{onClick:()=>me(!0),variant:"outline",size:"sm",disabled:A===0,children:"Save Template"}),xe.length>0&&e.jsx("div",{className:"relative",children:e.jsxs("select",{onChange:o=>{if(o.target.value){const E=xe.find(G=>G.id===o.target.value);E&&De(E),o.target.value=""}},className:"text-xs bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded px-2 py-1",defaultValue:"",children:[e.jsxs("option",{value:"",children:["Load Template (",xe.length,")"]}),xe.map(o=>e.jsxs("option",{value:o.id,children:[o.name," (",o.criteria.employeeCount," employees)"]},o.id))]})})]})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:a?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(he,{className:"mx-auto h-12 w-12 text-gray-400 animate-spin mb-4"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:"Analyzing employees..."}),e.jsx("p",{className:"text-sm text-gray-500",children:"This may take a few moments as we evaluate each employee for treatment opportunities."})]}):t.length>0?e.jsx("div",{className:"space-y-4",children:t.map(o=>{const E=w.has(o.employee.hr_code),G=o.lastResult&&o.lastResult.pre_churn_probability!=null&&o.lastResult.post_churn_probability!=null?Math.max(0,o.lastResult.pre_churn_probability-o.lastResult.post_churn_probability):null,H=o.projectedPostRviCategory||(o.lastResult?fe(o.lastResult.eltv_post_treatment??o.playgroundData.current_eltv??0,"quality"):null),b=o.lastResult?`${(o.lastResult.post_churn_probability*100).toFixed(1)}%`:"N/A",D=o.costPercentage&&o.costPercentage>0?Le(o.costPercentage):null,B=o.lastResult?Oe(o.lastResult.treatment_cost??o.topTreatment?.cost??0,o.employeeSalaryReference||o.employee.salary||o.playgroundData.current_features.employee_cost||0):o.costPercentage,K=B&&B>0?Le(B):null,Z=o.lastResult?l?[{label:"Post-churn",value:b},{label:"Churn reduction",value:G!==null?`${(G*100).toFixed(1)}%`:"N/A"},{label:"Post RVI",value:H??"N/A"},{label:"Cost share",value:K??"N/A"}]:[{label:"Post-churn",value:b},{label:"ROI",value:`${((o.lastResult.roi??0)*100).toFixed(1)}%`},{label:"New ELTV",value:le(o.lastResult.eltv_post_treatment??0)},{label:"Treatment cost",value:le(o.lastResult.treatment_cost??o.topTreatment?.cost??0)}]:[];return e.jsxs("div",{className:je("p-4 rounded-lg shadow-sm border transition-all",E?"bg-blue-50 dark:bg-blue-900/20 border-blue-300 dark:border-blue-600":"bg-white dark:bg-gray-800 border-gray-100 dark:border-gray-700",o.lastResult?"border-emerald-300 dark:border-emerald-500/60 ring-1 ring-emerald-100 dark:ring-emerald-500/30":"",o.isApplying?"opacity-90":""),children:[e.jsxs("div",{className:"flex justify-between items-start gap-4 mb-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",checked:E,onChange:()=>se(o.employee.hr_code),className:"mt-1 w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-gray-100",children:o.employee.full_name||o.employee.name}),o.lastResult&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300 px-2 py-0.5 text-xs font-medium",children:[e.jsx(Lr,{className:"h-3 w-3"})," Applied"]}),o.isApplying&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-blue-600 dark:text-blue-300",children:[e.jsx(he,{className:"h-3 w-3 animate-spin"})," Applying…"]})]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[o.employee.position," • ",o.employee.structure_name||o.employee.department]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mt-2 text-xs",children:[e.jsxs("span",{className:je("px-2 py-1 rounded-full",o.riskLevel==="High"?"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400":o.riskLevel==="Medium"?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400":"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400"),children:[o.riskLevel," Risk"]}),e.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:["Priority ",o.priorityScore?.toFixed(0)||"N/A"]}),o.lastResult&&e.jsx("span",{className:"text-emerald-600 dark:text-emerald-300 font-medium",children:l?`${G!==null?(G*100).toFixed(1):"0.0"}% churn drop`:`+${le(o.lastResult.treatment_effect_eltv??0)} impact`})]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx(de,{size:"sm",disabled:!o.topTreatment||o.isApplying,className:"bg-emerald-600 hover:bg-emerald-700 text-white",onClick:()=>v(o).catch(()=>{}),children:o.isApplying?e.jsx(he,{className:"h-3.5 w-3.5 animate-spin"}):"Apply Recommended"}),e.jsx(de,{size:"sm",variant:"outline",disabled:o.isApplying,onClick:()=>g(o.employee.id,o.topTreatment?.id),children:"View Details"})]})]}),o.topTreatment&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-blue-700 dark:text-blue-300",children:[e.jsx("h5",{className:"text-sm font-medium text-blue-900 dark:text-blue-100",children:"Recommended Treatment"}),l?e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsxs("span",{children:["Projected RVI ",H??"N/A"]}),D&&e.jsxs("span",{className:"text-[11px] text-blue-600/80 dark:text-blue-300/80",children:["Cost ",D," of salary"]})]}):e.jsxs("span",{children:["Cost ",le(o.topTreatment.cost||0)]})]}),e.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-200 mt-1",children:o.topTreatment.name}),l?e.jsxs("div",{className:"text-xs text-blue-700 dark:text-blue-300 mt-1 space-y-1",children:[e.jsxs("div",{children:["Churn drop ",(Math.max(0,o.potentialChurnReduction||0)*100).toFixed(1),"%"]}),D?e.jsxs("div",{children:["Cost share ",D," of salary"]}):null,e.jsxs("div",{children:["Time to impact: ",o.topTreatment.timeToEffect||"N/A"]})]}):e.jsxs("div",{className:"flex justify-between text-xs text-blue-700 dark:text-blue-300 mt-1",children:[e.jsxs("span",{children:["Expected Gain ",le(o.potentialELTVGain)]}),e.jsxs("span",{children:["Time to impact: ",o.topTreatment.timeToEffect||"N/A"]})]})]}),!o.topTreatment&&e.jsx("div",{className:"rounded-lg border border-dashed border-gray-200 dark:border-gray-700 p-3 mb-3 text-xs text-gray-600 dark:text-gray-400",children:"This employee does not currently have an AI-recommended treatment. Consider reviewing their profile manually."}),o.lastResult&&e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 text-xs text-gray-600 dark:text-gray-300 mb-3",children:Z.map((F,te)=>e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-200",children:F.label}),e.jsx("div",{children:F.value})]},`${o.employee.hr_code}-metric-${te}`))}),o.selectionCriteria&&o.selectionCriteria.length>0&&e.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium",children:"Why selected:"}),e.jsx("ul",{className:"list-disc list-inside ml-2 mt-1 space-y-1",children:o.selectionCriteria.slice(0,l?4:3).map((F,te)=>e.jsx("li",{children:F},te))})]}),o.lastError&&e.jsxs("div",{className:"mt-3 text-sm text-red-600 dark:text-red-400 flex items-center gap-2",children:[e.jsx(He,{className:"h-4 w-4"}),o.lastError]})]},o.employee.id)})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Vt,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900 dark:text-gray-100",children:"No candidates analyzed"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:'Click "Analyze Team" to get started.'})]})}),Se&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:"Save Template"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Template Name"}),e.jsx("input",{type:"text",value:ce,onChange:o=>$e(o.target.value),placeholder:"e.g., High Risk Engineering Team",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-gray-100"}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["This will save your current selection (",A," employees) and filters"]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(de,{onClick:ne,disabled:!ce.trim(),children:"Save Template"}),e.jsx(de,{onClick:()=>{me(!1),$e("")},variant:"outline",children:"Cancel"})]})]})})]})});export{on as Playground};
//# sourceMappingURL=Playground-D73bkvHo.js.map
